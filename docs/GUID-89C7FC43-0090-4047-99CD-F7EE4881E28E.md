# Motor Control Pulse-Width Modulation \(MCPWM\)

The PIC32MK GP/MC Family of devices support a dedicated Motor Control Pulse-Width Modulation \(PWM\) module with up to 12 outputs. The Motor Control PWM module consists of the following major features:

-   Two master time base modules with special event triggers

-   PWM module input clock prescaler

-   Two synchronization inputs

-   Two synchronization outputs

-   Eight PWM generators with complimentary output pairs

-   Four additional PWM generators with single ended outputs

-   Period, duty cycle, phase shift and dead time minimum resolution of 1 / FSYSCLK in Edge-Aligned mode and 2 / FSYSCLK minimum resolution in Center-Aligned mode

-   Cycle by cycle fault recovery and latched fault modes

-   PWM time-base capture upon current limit

-   Nine fault input pins are available for faults and current limits

-   Programmable analog-to-digital trigger with interrupt for each PWM pair

-   Complementary PWM outputs

-   Push-Pull PWM outputs

-   Redundant PWM outputs

-   Edge-Aligned PWM mode

-   Center-Aligned PWM mode

-   Variable Phase PWM mode

-   Multi-Phase PWM mode

-   Fixed-Off Time PWM mode

-   Current Limit PWM mode

-   Current Reset PWM mode

-   PWMxH and PWMxL output override control

-   PWMxH and PWMxL output pin swapping

-   Chopping mode \(also known as Gated mode\)

-   Dead time insertion

-   Dead time compensation

-   Enhanced Leading-Edge Blanking \(LEB\)

-   15 mA PWM pin output drive


**Using The Library**

This example shows how to configure the MCPWM to generate PWM signals whose duty and period can be configured independently.

```c
/* Duty cycle increment value */
#define DUTY_INCREMENT (10U)

/* Save PWM period */
uint16_t period;

/* This function is called after PWM0 counter event */
void PWM_PeriodHandler(uint32_t status, uintptr_t context)
{
    /* duty cycle values */
    static uint16_t duty0 = 0U;
    static uint16_t duty1 = 1000U;
    static uint16_t duty2 = 2000U;

    MCPWM_ChannelPrimaryDutySet(MCPWM_CH_1, duty0);
    MCPWM_ChannelPrimaryDutySet(MCPWM_CH_2, duty1);
    MCPWM_ChannelPrimaryDutySet(MCPWM_CH_3, duty2);
    
    /* Increment duty cycle values */
    duty0 += DUTY_INCREMENT;
    duty1 += DUTY_INCREMENT;
    duty2 += DUTY_INCREMENT;
    
    if (duty0 > period)
        duty0 = 0U;
    if (duty1 > period)
        duty1 = 0U;
    if (duty2 > period)
        duty2 = 0U;
}

int main ( void )
{
    /* Initialize all modules */
    SYS_Initialize ( NULL );
    
    /* Register callback function for Channel 0 counter event */
    MCPWM_CallbackRegister(MCPWM_CH_1, PWM_PeriodHandler, (uintptr_t)NULL);
    
    /* Read the period */
    period = MCPWM_PrimaryPeriodGet();
    
    /* Start all synchronous channels by starting channel 0*/
    MCPWM_Start();

    while ( true )
    {
        /* Maintain state machines of all polled MPLAB Harmony modules. */
        SYS_Tasks ( );
    }

    /* Execution should not come here during normal operation */

    return ( EXIT_FAILURE );
}
```

**Library Interface**

Peripheral library provides the following interfaces:

**Functions**

|Name|Description|
|----|-----------|
|MCPWM\_Initialize|Initializes given instance of MCPWM peripheral|
|MCPWM\_Start|Starts the MCPWM module|
|MCPWM\_Stop|Stops the given MCPWM module|
|MCPWM\_PrimaryPeriodSet|Sets the period value of the primary time base|
|MCPWM\_SecondaryPeriodSet|Sets the period value of the secondary time base|
|MCPWM\_PrimaryPeriodGet|Reads the period value of primary time base generator|
|MCPWM\_SecondaryPeriodGet|Reads the period value of secondary time base generator|
|MCPWM\_ChannelPrimaryDutySet|Writes the primary duty cycle value of given MCPWM channel|
|MCPWM\_ChannelSecondaryDutySet|Writes the secondary duty cycle value of given MCPWM channel|
|MCPWM\_ChannelDeadTimeSet|Writes dead time values of given MCPWM channel|
|MCPWM\_ChannelPrimaryTriggerSet|Writes the primary trigger compare value to trigger ADC conversion|
|MCPWM\_ChannelSecondaryTriggerSet|Writes the secondary trigger compare value to trigger ADC conversion|
|MCPWM\_PrimaryEventCallbackRegister|Registers the function to be called from interrupt|
|MCPWM\_SecondaryEventCallbackRegister|Registers the function to be called from interrupt|
|MCPWM\_CallbackRegister|Registers the function to be called from interrupt|
|MCPWM\_ChannelPinsOverrideEnable|Enables PWM output pins override function|
|MCPWM\_ChannelPinsOverrideDisable|Disables PWM output pins override function|
|MCPWM\_ChannelPinsOwnershipEnable|Sets the PWM output pins ownership to PWM generator|
|MCPWM\_ChannelPinsOwnershipDisable|Sets the PWM output pins ownership to GPIO|

**Data types and constants**

|Name|Type|Description|
|----|----|-----------|
|MCPWM\_CH\_CALLBACK|Typedef|Defines the data type and function signature for the MCPWM peripheral callback function|
|MCPWM\_CALLBACK|Typedef|Defines the data type and function signature for the MCPWM peripheral callback function for primary event and secondary event|
|MCPWM\_CH\_NUM|Enum|Identifies MCPWM channel number in a MCPWM peripheral|
|MCPWM\_CH\_STATUS|Enum|Identifies MCPWM channel event status|

-   **[MCPWM\_Stop Function](GUID-765A107F-6DA0-4822-BF55-F4ACB894B908.md)**  

-   **[MCPWM\_Start Function](GUID-9FAB43AA-6CCE-4165-B2A7-3E90D57FF3FF.md)**  

-   **[MCPWM\_SecondaryPeriodSet Function](GUID-3A5A28EF-7969-4607-BF84-BF91A5B76AD7.md)**  

-   **[MCPWM\_SecondaryPeriodGet Function](GUID-EBE7D218-523D-469C-A4D3-F3EA936A7F8E.md)**  

-   **[MCPWM\_SecondaryEventCallbackRegister Function](GUID-F03F7B38-8864-472E-B2B3-90DE1DA8B618.md)**  

-   **[MCPWM\_PrimaryPeriodSet Function](GUID-A2DF5750-74D5-40F2-BDA3-C0FEE9475A0C.md)**  

-   **[MCPWM\_PrimaryPeriodGet Function](GUID-9730667D-D95E-4571-8EC3-B08E29676601.md)**  

-   **[MCPWM\_PrimaryEventCallbackRegister Function](GUID-A91DA126-E7A6-4099-9C37-CD259A66DE64.md)**  

-   **[MCPWM\_Initialize Function](GUID-3AE0FCE3-BB87-4C16-9D8A-69BECA9D56AC.md)**  

-   **[MCPWM\_ChannelSecondaryTriggerSet Function](GUID-4669723F-EFDD-4762-8C39-610D63512798.md)**  

-   **[MCPWM\_ChannelSecondaryDutySet Function](GUID-8105D255-A05D-4792-B402-8679C1CE72D8.md)**  

-   **[MCPWM\_ChannelPrimaryTriggerSet Function](GUID-B9B23A6E-AD3E-4013-AC33-D9438555AC67.md)**  

-   **[MCPWM\_ChannelPrimaryDutySet Function](GUID-BCA87D7E-B37D-438C-878A-0CE948A827F8.md)**  

-   **[MCPWM\_ChannelPinsOwnershipEnable Function](GUID-10B7E27B-B186-4834-B660-0B207940C776.md)**  

-   **[MCPWM\_ChannelPinsOwnershipDisable Function](GUID-92716803-A0AB-49C6-9CEA-088AA6B55B94.md)**  

-   **[MCPWM\_ChannelPinsOverrideEnable Function](GUID-41F10141-0DF1-48A9-BD85-4E6EC4B6B5D0.md)**  

-   **[MCPWM\_ChannelPinsOverrideDisable Function](GUID-DCC0C362-8D24-418E-AECB-7DEC492B69EA.md)**  

-   **[MCPWM\_ChannelDeadTimeSet Function](GUID-EDA2915B-5B6B-4B7E-8529-2E9503437BDA.md)**  

-   **[MCPWM\_CH\_STATUS Enum](GUID-45E4A540-8FCD-45EA-A4D8-D778F2973EAE.md)**  

-   **[MCPWM\_CH\_NUM Enum](GUID-8710CD50-9161-47EE-BD2B-0C9C47B09E33.md)**  

-   **[MCPWM\_CH\_CALLBACK Typedef](GUID-7B964EB0-B256-4534-ABAC-7E93DB4DE626.md)**  

-   **[MCPWM\_CallbackRegister Function](GUID-CDAB5DA1-01DC-4C9C-BDB3-B3652FAC1D3C.md)**  

-   **[MCPWM\_CALLBACK Typedef](GUID-2CFC8D5B-0C1C-4688-8D02-4C66516797DD.md)**  


**Parent topic:**[PIC32MK GPD GPE MCF Peripheral Libraries](GUID-A63F4C14-72E7-44D7-9C70-A48BBD41B583.md)

**Parent topic:**[PIC32MK GPG MCJ Peripheral Libraries](GUID-A0350A48-03F7-4370-A6C5-612386A4ABAC.md)

**Parent topic:**[PIC32MK GPK MCM Peripheral Libraries](GUID-801B9DE7-4616-4E38-BF86-C82B78A4F430.md)

**Parent topic:**[PIC32MK MCA Peripheral Libraries](GUID-E11C5899-DD12-4B78-8076-8A415C20F144.md)

