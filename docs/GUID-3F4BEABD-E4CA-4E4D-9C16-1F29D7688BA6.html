<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="SPIx_WriteRead Function" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="spix-writeread-function" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>SPIx_WriteRead Function</title>
<meta name="Microsoft.Help.Id" content="GUID-1EA9B250-D935-443A-9FA9-C48E50D229E8-spix-writeread-function" />
<meta name="Microsoft.Help.TocParent" content="GUID-1EA9B250-D935-443A-9FA9-C48E50D229E8" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony Peripheral Libraries Reference A 09/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-3F4BEABD-E4CA-4E4D-9C16-1F29D7688BA6"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="spix-writeread-function">
<h1 class="title topictitle1" id="ariaid-title1">SPIx_WriteRead Function</h1><div class="body"></div>
<div class="topic nested1" aria-labelledby="ariaid-title2" id="c"><h2 class="title topictitle2" id="ariaid-title2">C</h2><div class="body"><pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d157442e14', this);">Copy</button><code id="d157442e14" content="/* x = SPI instance number */&#xA;&#xA;/* SPI master mode */&#xA;&#xA;bool SPIx_WriteRead ( void* pTransmitData, size_t txSize, void* pReceiveData, size_t rxSize)"><span class="ph token comment">/* x = SPI instance number */</span>

<span class="ph token comment">/* SPI master mode */</span>

bool SPIx_WriteRead <span class="ph token punctuation">(</span> <span class="ph token keyword">void</span><span class="ph token operator">*</span> pTransmitData<span class="ph token punctuation">,</span> size_t txSize<span class="ph token punctuation">,</span> <span class="ph token keyword">void</span><span class="ph token operator">*</span> pReceiveData<span class="ph token punctuation">,</span> size_t rxSize<span class="ph token punctuation">)</span></code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title3" id="summary"><h2 class="title topictitle2" id="ariaid-title3">Summary</h2><div class="body"><p class="p">Write and Read data on SPI peripheral.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title4" id="description"><h2 class="title topictitle2" id="ariaid-title4">Description</h2><div class="body"><p class="p">This function transmits "txSize" number of bytes and receives "rxSize" number of bytes on SPI module. Data pointed by pTransmitData is transmitted and received data is saved in the location pointed by pReceiveData. The function will transfer the maximum of "txSize" or "rxSize" data units towards completion.</p>
<p class="p">When interrupt is disabled, this function will be blocking in nature. In this mode, the function will not return until all the requested data is transferred. The function returns true after transferring all the data. This indicates that the operation has been completed.</p>
<p class="p">When interrupt is enabled, the function will be non-blocking in nature. The function returns immediately. The data transfer process continues in the peripheral interrupt. The application specified transmit and receive buffer are owned by the library until the data transfer is complete and should not be modified by the application till the transfer is complete. Only one transfer is allowed at any time. The Application can use a callback function or a polling function to check for completion of the transfer. If a callback is required, this should be registered prior to calling the SPIx_WriteRead function. The application can use the SPIx_IsBusy to poll for completion.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title5" id="precondition"><h2 class="title topictitle2" id="ariaid-title5">Precondition</h2><div class="body"><p class="p">The SPIx_Initialize function must have been called. If the peripheral instance has been configured for Interrupt mode and transfer completion status needs to be communicated back to application via callback, a callback should have been registered using SPIx_CallbackRegister function.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title6" id="parameters"><h2 class="title topictitle2" id="ariaid-title6">Parameters</h2><div class="body">
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d157442e78"><span>Param</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d157442e80"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d157442e78 "><span>pTransmitData</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d157442e80 "><span>Pointer to the data which has to be transmitted. In a case where only data reception is required, this pointer can be set to NULL. The size of this buffer should be txSize.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d157442e78 "><span>txSize</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d157442e80 "><span>Number of bytes to be transmitted. This value is the byte size of the buffer irrespective of 8/16/32 bit transfer mode.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d157442e78 "><span>pReceiveData</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d157442e80 "><span>Pointer to the location where the received data has to be stored. It is user's responsibility to ensure that this location has sufficient memory to store rxSize amount of data. In a case where only data transmission is required, this pointer can be set to NULL.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d157442e78 "><span>rxSize</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d157442e80 "><span>Number of bytes to be received. rxSize must be sum of txSize plus the number of bytes to receive. For example, if 3 bytes are transmitted and 10 bytes are to be received, then the rxSize must be 13. This value is the byte size of the buffer irrespective of 8/16/32 bit transfer mode.</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title7" id="returns"><h2 class="title topictitle2" id="ariaid-title7">Returns</h2><div class="body"><p class="p"><em class="ph i">true</em> - If configured for blocking mode, the function has received and transmitted the requested number of bytes. If configured for non-blocking mode, the request was accepted successfully and will be processed in the interrupt.</p>
<p class="p"><em class="ph i">false</em> - If both pTransmitData and pReceiveData are NULL, or if both txSize and rxSize are 0 or if txSize is non-zero but the pTransmitData is set to NULL or rxSize is non-zero but pReceiveData is NULL. In non-blocking mode, the function returns false if there is an on-going data transfer at the time of calling the function.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title8" id="example"><h2 class="title topictitle2" id="ariaid-title8">Example</h2><div class="body"><p class="p"><em class="ph i">Non-blocking mode</em></p>
<pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d157442e122', this);">Copy</button><code id="d157442e122" content="// The following code snippet shows an example using the&#xA;// SPIx_WriteRead() function in interrupt mode operation using the&#xA;// callback function.&#xA;&#xA;uint8_t txBuffer[4];&#xA;uint8_t rxBuffer[10];&#xA;size_t txSize = 4;&#xA;size_t rxSize = 10;&#xA;&#xA;void APP_SPITransferHandler(uintptr_t context)&#xA;{&#xA;    //Transfer was completed without error, do something else now.&#xA;}&#xA;&#xA;SPI1_Initialize();&#xA;SPI1_CallbackRegister(&amp;APP_SPITransferHandler, (uintptr_t)NULL);&#xA;if(SPI1_WriteRead(&amp;txBuffer, txSize, &amp;rxBuffer, rxSize))&#xA;{&#xA;    // request got accepted&#xA;}&#xA;else&#xA;{&#xA;    // request didn't get accepted, try again later with correct arguments&#xA;}"><span class="ph token comment">// The following code snippet shows an example using the</span>
<span class="ph token comment">// SPIx_WriteRead() function in interrupt mode operation using the</span>
<span class="ph token comment">// callback function.</span>

uint8_t txBuffer<span class="ph token punctuation">[</span><span class="ph token number">4</span><span class="ph token punctuation">]</span><span class="ph token punctuation">;</span>
uint8_t rxBuffer<span class="ph token punctuation">[</span><span class="ph token number">10</span><span class="ph token punctuation">]</span><span class="ph token punctuation">;</span>
size_t txSize <span class="ph token operator">=</span> <span class="ph token number">4</span><span class="ph token punctuation">;</span>
size_t rxSize <span class="ph token operator">=</span> <span class="ph token number">10</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">void</span> <span class="ph token function">APP_SPITransferHandler</span><span class="ph token punctuation">(</span>uintptr_t context<span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    <span class="ph token comment">//Transfer was completed without error, do something else now.</span>
<span class="ph token punctuation">}</span>

<span class="ph token function">SPI1_Initialize</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
<span class="ph token function">SPI1_CallbackRegister</span><span class="ph token punctuation">(</span><span class="ph token operator">&amp;</span>APP_SPITransferHandler<span class="ph token punctuation">,</span> <span class="ph token punctuation">(</span>uintptr_t<span class="ph token punctuation">)</span><span class="ph token constant">NULL</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
<span class="ph token keyword">if</span><span class="ph token punctuation">(</span><span class="ph token function">SPI1_WriteRead</span><span class="ph token punctuation">(</span><span class="ph token operator">&amp;</span>txBuffer<span class="ph token punctuation">,</span> txSize<span class="ph token punctuation">,</span> <span class="ph token operator">&amp;</span>rxBuffer<span class="ph token punctuation">,</span> rxSize<span class="ph token punctuation">)</span><span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    <span class="ph token comment">// request got accepted</span>
<span class="ph token punctuation">}</span>
<span class="ph token keyword">else</span>
<span class="ph token punctuation">{</span>
    <span class="ph token comment">// request didn't get accepted, try again later with correct arguments</span>
<span class="ph token punctuation">}</span></code></pre><p class="p"><em class="ph i">Blocking mode</em></p>
<pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d157442e275', this);">Copy</button><code id="d157442e275" content="// The following code snippet shows non-interrupt or blocking mode&#xA;// operation.&#xA;&#xA;uint8_t txBuffer[4];&#xA;uint8_t rxBuffer[10];&#xA;size_t txSize = 4;&#xA;size_t rxSize = 10;&#xA;&#xA;SPI1_Initialize();&#xA;&#xA;// This function call will block.&#xA;SPI1_WriteRead(&amp;txBuffer, txSize, &amp;rxBuffer, rxSize);&#xA;"><span class="ph token comment">// The following code snippet shows non-interrupt or blocking mode</span>
<span class="ph token comment">// operation.</span>

uint8_t txBuffer<span class="ph token punctuation">[</span><span class="ph token number">4</span><span class="ph token punctuation">]</span><span class="ph token punctuation">;</span>
uint8_t rxBuffer<span class="ph token punctuation">[</span><span class="ph token number">10</span><span class="ph token punctuation">]</span><span class="ph token punctuation">;</span>
size_t txSize <span class="ph token operator">=</span> <span class="ph token number">4</span><span class="ph token punctuation">;</span>
size_t rxSize <span class="ph token operator">=</span> <span class="ph token number">10</span><span class="ph token punctuation">;</span>

<span class="ph token function">SPI1_Initialize</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token comment">// This function call will block.</span>
<span class="ph token function">SPI1_WriteRead</span><span class="ph token punctuation">(</span><span class="ph token operator">&amp;</span>txBuffer<span class="ph token punctuation">,</span> txSize<span class="ph token punctuation">,</span> <span class="ph token operator">&amp;</span>rxBuffer<span class="ph token punctuation">,</span> rxSize<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
</code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title9" id="remarks"><h2 class="title topictitle2" id="ariaid-title9">Remarks</h2><div class="body"><p class="p">None</p>
</div>
</div>
</body>
</html>