<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="Input Capture (ICAP)" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="input-capture-icap" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>Input Capture (ICAP)</title>
<meta name="Microsoft.Help.Id" content="GUID-1EA9B250-D935-443A-9FA9-C48E50D229E8-input-capture-icap" />
<meta name="Microsoft.Help.TocParent" content="GUID-1EA9B250-D935-443A-9FA9-C48E50D229E8" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony Peripheral Libraries Reference A 09/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-E126A9DC-A2E6-405E-85E7-9FB676BDEBD2"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="input-capture-icap">
<h1 class="title topictitle1" id="ariaid-title1">Input Capture (ICAP)</h1><div class="body"><p class="p">The Input Capture module is useful in applications requiring frequency (period) and pulse measurement.
The Input Capture module captures the 16-bit or 32-bit value of the selected Time Base registers when an event occurs at the ICx pin.
Capture events are caused by the following:</p>
<ul class="ul"><li class="li"><p class="p">Capture timer value on every edge (rising and falling), specified edge first</p>
</li>
<li class="li"><p class="p">Prescaler capture event modes:</p>
<ul class="ul"><li class="li"><p class="p">Capture timer value on every 4th rising edge of input at ICx pin</p>
</li>
<li class="li"><p class="p">Capture timer value on every 16th rising edge of input at ICx pin
Each input capture channel can select between one of six 16-bit timers for the time base, or two of six 16-bit timers together to form a 32-bit timer. The selected timer can use either an internal or external clock.</p>
</li>
</ul>
</li>
</ul>
<p class="p"><strong class="ph b">Using The Library</strong></p>
<p class="p">In this application, a pulse signal is generated using the OCMP peripheral and is fed to the ICAP input. ICAP peripheral captures the time at every edge and displays the pulse width on the serial terminal.</p>
<pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d780579e31', this);">Copy</button><code id="d780579e31" content="uint16_t capturedValue[2];&#xA;volatile uint8_t captureIndex = 0;&#xA;&#xA;int main ( void )&#xA;{&#xA;    /* Initialize all modules */&#xA;    SYS_Initialize ( NULL );&#xA;    &#xA;    ICAP1_Enable();&#xA;    &#xA;    OCMP3_Enable();&#xA;    &#xA;    TMR2_Start();&#xA;    &#xA;    while ( true )&#xA;    {&#xA;        /* Maintain state machines of all polled MPLAB Harmony modules. */&#xA;        SYS_Tasks ( );&#xA;        &#xA;        while(!ICAP1_CaptureStatusGet());&#xA;&#xA;        capturedValue[captureIndex++] = ICAP1_CaptureBufferRead();&#xA;&#xA;        if ( captureIndex &gt; 1){&#xA;            printf(&#34;Pulse Width Count = %d\r\n&#34;,(capturedValue[1] - capturedValue[0]));&#xA;            captureIndex = 0;&#xA;        }&#xA;    }&#xA;&#xA;    /* Execution should not come here during normal operation */&#xA;&#xA;    return ( EXIT_FAILURE );&#xA;}&#xA;">uint16_t capturedValue<span class="ph token punctuation">[</span><span class="ph token number">2</span><span class="ph token punctuation">]</span><span class="ph token punctuation">;</span>
<span class="ph token keyword">volatile</span> uint8_t captureIndex <span class="ph token operator">=</span> <span class="ph token number">0</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">int</span> main <span class="ph token punctuation">(</span> <span class="ph token keyword">void</span> <span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    <span class="ph token comment">/* Initialize all modules */</span>
    SYS_Initialize <span class="ph token punctuation">(</span> <span class="ph token constant">NULL</span> <span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
    
    <span class="ph token function">ICAP1_Enable</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
    
    <span class="ph token function">OCMP3_Enable</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
    
    <span class="ph token function">TMR2_Start</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
    
    <span class="ph token keyword">while</span> <span class="ph token punctuation">(</span> true <span class="ph token punctuation">)</span>
    <span class="ph token punctuation">{</span>
        <span class="ph token comment">/* Maintain state machines of all polled MPLAB Harmony modules. */</span>
        SYS_Tasks <span class="ph token punctuation">(</span> <span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
        
        <span class="ph token keyword">while</span><span class="ph token punctuation">(</span><span class="ph token operator">!</span><span class="ph token function">ICAP1_CaptureStatusGet</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

        capturedValue<span class="ph token punctuation">[</span>captureIndex<span class="ph token operator">++</span><span class="ph token punctuation">]</span> <span class="ph token operator">=</span> <span class="ph token function">ICAP1_CaptureBufferRead</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

        <span class="ph token keyword">if</span> <span class="ph token punctuation">(</span> captureIndex <span class="ph token operator">&gt;</span> <span class="ph token number">1</span><span class="ph token punctuation">)</span><span class="ph token punctuation">{</span>
            <span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">"Pulse Width Count = %d\r\n"</span><span class="ph token punctuation">,</span><span class="ph token punctuation">(</span>capturedValue<span class="ph token punctuation">[</span><span class="ph token number">1</span><span class="ph token punctuation">]</span> <span class="ph token operator">-</span> capturedValue<span class="ph token punctuation">[</span><span class="ph token number">0</span><span class="ph token punctuation">]</span><span class="ph token punctuation">)</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
            captureIndex <span class="ph token operator">=</span> <span class="ph token number">0</span><span class="ph token punctuation">;</span>
        <span class="ph token punctuation">}</span>
    <span class="ph token punctuation">}</span>

    <span class="ph token comment">/* Execution should not come here during normal operation */</span>

    <span class="ph token keyword">return</span> <span class="ph token punctuation">(</span> EXIT_FAILURE <span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
<span class="ph token punctuation">}</span>
</code></pre><p class="p"><strong class="ph b">Library Interface</strong></p>
<p class="p">Peripheral library provides the following interfaces:</p>
<p class="p"><strong class="ph b">Functions</strong></p>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d780579e275"><span>Name</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d780579e277"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e275 "><span>ICAPx_Initialize</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e277 "><span>Initializes ICAPx module of the device</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e275 "><span>ICAPx_Enable</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e277 "><span>Enable function for the ICAPx peripheral</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e275 "><span>ICAPx_Disable</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e277 "><span>Disable function for the ICAPx peripheral</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e275 "><span>ICAPx_CaptureBufferRead</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e277 "><span>Read buffer function ICAPx peripheral</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e275 "><span>ICAPx_CaptureStatusGet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e277 "><span>Reads current state buffer not empty status</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e275 "><span>ICAPx_ErrorStatusGet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e277 "><span>Reads current state overflow status ICAPx status</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e275 "><span>ICAPx_CallbackRegister</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e277 "><span>Sets the callback function for a ICAPx interrupt</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e275 "><span>ICAPx_Error_CallbackRegister</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e277 "><span>Sets the callback function for a ICAP error interrupt</span></td>
</tr>
</tbody>
</table>
</div>
<p class="p"><strong class="ph b">Data types and constants</strong></p>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d780579e330"><span>Name</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d780579e332"><span>Type</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d780579e334"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e330 "><span>ICAP_STATUS_SOURCE</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e332 "><span>Enum</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e334 "><span>Identifies ICAP status source mask</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e330 "><span>ICAP_CALLBACK</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e332 "><span>Typedef</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d780579e334 "><span>Defines the function pointer data type and function signature for the ICAPx callback function</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</body>
</html>