# Capture/Compare/PWM \(CCP\)

A CCP module can operate in any one of the below three modes.

-   Timer mode - is used for periodic delay.

-   Output Compare/PWM mode - is used to generate waveforms

-   Input Capture mode - is used to measure delay, pulse width and frequency of the input signal.


**Timer mode**

The CCP channel in timer mode provides following features:

-   Periodic CPU interrupts

-   Master time base function for synchronizing other CCP modules

-   Triggering periodic ADC conversion

-   Periodic wake from Sleep \(if an appropriate clock source is available\)


**Using The Library**

When the timer is enabled, it increments by one on every rising edge of the input clock, and generates an interrupt on a period match. Timer mode is used for periodic interrupt generation.

This example demonstrates how to use CCP channel in timer mode to generate periodic callback.

```c
/* This function is called after period expires */
void CCP0_Callback_InterruptHandler(uint32_t status, uintptr_t context)
{
    /* Toggle LED */
    LED_Toggle();
}

int main ( void )
{
    /* Initialize all modules */
    SYS_Initialize ( NULL );

    /* Register callback function for CCP0 period interrupt */
    CCP0_TimerCallbackRegister(CCP0_Callback_InterruptHandler, (uintptr_t)NULL);

    /* Start the timer channel 0*/
    CCP0_TimerStart();

    while ( true )
    {
        /* Maintain state machines of all polled MPLAB Harmony modules. */
        SYS_Tasks ( );
    }

    /* Execution should not come here during normal operation */

    return ( EXIT_FAILURE );
}
```

**Compare mode**

The CCP channel in compare mode is used for waveform generation. This provides below features:

-   Output Compare mode can generate a single output transition or a train of output pulses, and can generate interrupts on match-on-compare events.

-   Output Compare mode can function as a PWM generator.

-   In MCCP modules, multiple PWM outputs can be used for power or motor control applications.


**Using The Library**

This peripheral supports below output compare modes:

-   Single edge and dual edge compare modes

-   Center-aligned compare mode


MCCP \(Multiple CCP\) modules support below extended PWM features:

-   Single Output Steerable mode

-   Brush DC Motor \(Forward and Reverse\) modes

-   Half-Bridge with Dead-Time Delay mode

-   Push-Pull PWM mode

-   Output Scan mode

-   Center-Aligned Compare mode

-   Variable Frequency Pulse mode

-   Auto-Shutdown with Programmable Source and Shutdown State

-   Programmable Output Polarity


This peripheral library allows to set the period and duty cycle of the output waveform. And supports period overflow interrupt and compare match interrupt.

**Capture mode**

This mode is used to capture a timer value from an independent timer base on the occurrence of an event on an input pin.<br />This mode is useful in applications requiring frequency \(time period\) and pulse measurement. Input Capture mode uses the CCPxTMR registers as a dedicated 16/32-bit synchronous, up counting timer used for event capture. This value is written to the FIFO buffer when a capture event occurs. The internal value may also be read with a synchronization delay from the CCPxTMR registers.

**Using The Library**

CCP peripheral when configured in capture mode, captures the time interval of input signal.

It provides both polling and callback methods to indicate capture event has occurred.<br />With polling, the application will need to continuously poll to check if the capture event has occurred.<br />With callback, the registered callback function will be called when the capture event occurs. This means the application do not have to poll continuously.

Callback method<br />This example demonstrates how to use CCP in capture mode to measure pulse width.

```c

/* This function is called after Capture 0 interrupt */
void CCP0_CaptureInterruptHandler(uintptr_t context)
{
    /* Read Captured values */
    pulse_width = CCP0_Capture16bitBufferRead();
}

int main(void)
{

    /* Register callback function for period interrupt */
    CCP0_CaptureCallbackRegister(CCP0_CaptureInterruptHandler, (uintptr_t)NULL);

    /* Start the Capture */
    CCP0_CaptureStart();
}
```

**Library Interface**

Peripheral library provides the following interfaces:

**Functions**

|Name|Description|
|----|-----------|
|CCPx\_TimerInitialize|Initializes given instance of CCP|
|CCPx\_TimerStart|Starts the timer for given CCP instance|
|CCPx\_TimerStop|Stops the timer for given CCP instance|
|CCPx\_Timer16bitPeriodSet|Sets the period value of a given timer|
|CCPx\_Timer16bitPeriodGet|Reads the period value of given timer|
|CCPx\_Timer16bitCounterGet|Reads the timer current count value|
|CCPx\_Timer32bitPeriodSet|Sets the period value of a given timer|
|CCPx\_Timer32bitPeriodGet|Reads the period value of given timer|
|CCPx\_Timer32bitCounterGet|Reads the timer current count value|
|CCPx\_TimerFrequencyGet|Provides the given timer's counter-increment frequency|
|CCPx\_TimerCallbackRegister|Registers the function to be called from interrupt|
|CCPx\_TimerInterruptEnable|Enables timer interrupt|
|CCPx\_TimerInterruptDisable|Disables timer interrupt|
|CCPx\_CaptureInitialize|Initializes given instance of CCP|
|CCPx\_CaptureStart|Starts the timer for given CCP instance|
|CCPx\_CaptureStop|Stops the timer for given CCP instance|
|CCPx\_Capture16bitBufferRead|Reads 16 bit capture value|
|CCPx\_Capture32bitBufferRead|Reads 32 bit capture value|
|CCPx\_CaptureStatusGet|Reads status capture operation|
|CCPx\_CaptureCallbackRegister|Registers the function to be called from interrupt|
|CCPx\_CompareInitialize|Initializes given instance of CCP|
|CCPx\_CompareStart|Starts the timer for given CCP instance|
|CCPx\_CompareStop|Stops the timer for given CCP instance|
|CCPx\_CompareAutoShutdownClear|Clears auto shutdown event status|
|CCPx\_CompareAutoShutdownSet|Enable auto shutdown|
|CCPx\_Compare16bitPeriodValueSet|Sets the period value of a given timer|
|CCPx\_Compare16bitPeriodValueGet|Reads the period value of given timer|
|CCPx\_Compare16bitValueGet|Reads the timer current count value|
|CCPx\_Compare16bitValueSet|Sets new timer counter value|
|CCPx\_Compare16bitRAValueSet|Writes compare value of the given compare channel 0|
|CCPx\_Compare16bitRAValueGet|Gets lower 16 bits of compare value|
|CCPx\_Compare16bitRBValueSet|Writes higher 16bits of compare value|
|CCPx\_Compare16bitRBValueGet|Gets higher 16 bits of compare value|
|CCPx\_Compare32bitPeriodValueSet|Sets the period value of a given timer|
|CCPx\_Compare32bitPeriodValueGet|Reads the period value of given timer|
|CCPx\_Compare32bitValueGet|Reads the 32bit comapre value|
|CCPx\_Compare32bitValueSet|Sets 32bit compare value|
|CCPx\_CompareCallbackRegister|Registers the function to be called from interrupt|

**Data types and constants**

|Name|Type|Description|
|----|----|-----------|
|CCP\_TIMER\_CALLBACK|Typedef|Defines the function pointer data type and function signature for the ccp channel callback function|
|CCP\_COMPARE\_CALLBACK|Typedef|Defines the function pointer data type and function signature for the ccp channel callback function|
|CCP\_CAPTURE\_CALLBACK|Typedef|Defines the function pointer data type and function signature for the ccp channel callback function|

-   **[CCPx\_TimerStop Function](GUID-C8C23966-7936-4110-AE01-65E4CE6D7041.md)**  

-   **[CCPx\_TimerStart Function](GUID-FFDF7B4D-4613-42CC-BFFD-6461347F4BC7.md)**  

-   **[CCPx\_TimerInterruptEnable Function](GUID-6564DB4B-843D-4E01-9B03-915205EC73EC.md)**  

-   **[CCPx\_TimerInterruptDisable Function](GUID-E7DA0A06-CCB6-4541-8DA3-03B3EEA70EA9.md)**  

-   **[CCPx\_TimerInitialize Function](GUID-4D9580F2-2925-4476-A048-22378C0AC1FB.md)**  

-   **[CCPx\_TimerFrequencyGet Function](GUID-9FC1548B-AD00-44B7-8B14-052D8962DFF2.md)**  

-   **[CCPx\_TimerCallbackRegister Function](GUID-C7F9040E-CF77-4328-8DAE-465D98E9D29A.md)**  

-   **[CCPx\_Timer32bitPeriodSet Function](GUID-06510FEF-E7E1-480A-89FF-71BD2F941FE8.md)**  

-   **[CCPx\_Timer32bitPeriodGet Function](GUID-936C8257-2202-486B-A20B-6F9B55C4D2F7.md)**  

-   **[CCPx\_Timer32bitCounterGet Function](GUID-80A5BA2A-0A27-4C78-B15E-E54E523E5A0F.md)**  

-   **[CCPx\_Timer16bitPeriodSet Function](GUID-A91E2750-6CC6-403C-AFA8-D589970AB3A2.md)**  

-   **[CCPx\_Timer16bitPeriodGet Function](GUID-414463EA-4349-42C4-843E-7DAE854582EA.md)**  

-   **[CCPx\_Timer16bitCounterGet Function](GUID-954B99B1-368E-47C4-80B3-D3BE05894B49.md)**  

-   **[CCPx\_CompareStop Function](GUID-024BC63E-12DA-417F-86B2-DC64D7FFD594.md)**  

-   **[CCPx\_CompareStart Function](GUID-C5EE04EF-E895-420F-B275-D86ACB7AA1B9.md)**  

-   **[CCPx\_CompareInitialize Function](GUID-14A90050-DCEE-4255-A1A5-EA4FB722B99D.md)**  

-   **[CCPx\_CompareCallbackRegister Function](GUID-1A4F96F6-13EC-431E-8CEF-9BD6F3FDB6B8.md)**  

-   **[CCPx\_CompareAutoShutdownSet Function](GUID-7640AAA7-B56F-4116-BD70-461CEBD61132.md)**  

-   **[CCPx\_CompareAutoShutdownClear Function](GUID-C8C40311-70F5-4411-AEBA-C0D987953CBB.md)**  

-   **[CCPx\_Compare32bitValueSet Function](GUID-7120E0D0-4823-410B-8A0B-F67D1781B5B5.md)**  

-   **[CCPx\_Compare32bitValueGet Function](GUID-D3924027-752C-44E5-950A-662870436F25.md)**  

-   **[CCPx\_Compare32bitPeriodValueSet Function](GUID-42856842-D1C4-4146-B6A1-873D708CA8EC.md)**  

-   **[CCPx\_Compare32bitPeriodValueGet Function](GUID-8F44E1F0-914C-4E3D-B522-FA76F71C92CA.md)**  

-   **[CCPx\_Compare16bitValueSet Function](GUID-3C5DD798-69E4-4887-9129-089B6F6F2D04.md)**  

-   **[CCPx\_Compare16bitValueGet Function](GUID-99A3DE27-723F-43D9-AF5A-F552595DC7C1.md)**  

-   **[CCPx\_Compare16bitRBValueSet Function](GUID-0DD6E334-A25C-4ECE-9BE0-6B177D70D9EC.md)**  

-   **[CCPx\_Compare16bitRBValueGet Function](GUID-6F65F8D6-6D7A-4724-86F6-D84DD0DD879A.md)**  

-   **[CCPx\_Compare16bitRAValueSet Function](GUID-70DCA97E-0C73-42AA-8E0F-103458614919.md)**  

-   **[CCPx\_Compare16bitRAValueGet Function](GUID-90B642BF-76D7-4500-BE90-271250B989F6.md)**  

-   **[CCPx\_Compare16bitPeriodValueSet Function](GUID-6C8D3D89-ECA2-4100-BD39-A1A5E79DB148.md)**  

-   **[CCPx\_Compare16bitPeriodValueGet Function](GUID-24F2B928-E3B0-440B-84BA-48F585F31708.md)**  

-   **[CCPx\_CaptureStop Function](GUID-475D79C1-A516-4D34-ADC4-EA98AD65AA62.md)**  

-   **[CCPx\_CaptureStatusGet Function](GUID-9C05B77E-E797-473B-A9A4-C149A4D12D16.md)**  

-   **[CCPx\_CaptureStart Function](GUID-D328B06E-8B37-432D-B165-5F869C5B1F2D.md)**  

-   **[CCPx\_CaptureInitialize Function](GUID-04F02623-59DB-4718-B53A-E347B0610A0B.md)**  

-   **[CCPx\_CaptureCallbackRegister Function](GUID-13582B47-16D5-4366-B1BF-716B16FF33BD.md)**  

-   **[CCPx\_Capture32bitBufferRead Function](GUID-934A0F72-859B-41D6-AA30-158620703E3A.md)**  

-   **[CCPx\_Capture16bitBufferRead Function](GUID-84E326EC-EF6F-45D1-8EC9-FA2E0204192E.md)**  

-   **[CCP\_TIMER\_CALLBACK Typedef](GUID-EE09DFB7-F2D2-4625-A728-C71299F7C405.md)**  

-   **[CCP\_COMPARE\_CALLBACK Typedef](GUID-290E2445-E58A-4505-BB33-17C0355C0BC5.md)**  

-   **[CCP\_CAPTURE\_CALLBACK Typedef](GUID-2B9C969C-6C2C-4BFA-B64A-0F844B01B0DE.md)**  


**Parent topic:**[PIC32MM GPL Peripheral Libraries](GUID-1AE2B428-AA57-43A7-A52E-C35ABF67EDC4.md)

**Parent topic:**[PIC32MM GPM Peripheral Libraries](GUID-CB22E113-2DFF-40FB-BA9B-BFA1C8003FEC.md)

