<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="Output Compare (OCMP)" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="output-compare-ocmp" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>Output Compare (OCMP)</title>
<meta name="Microsoft.Help.Id" content="GUID-1EA9B250-D935-443A-9FA9-C48E50D229E8-output-compare-ocmp" />
<meta name="Microsoft.Help.TocParent" content="GUID-1EA9B250-D935-443A-9FA9-C48E50D229E8" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony Peripheral Libraries Reference A 09/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-B86A6AAC-1577-4BDA-9CB1-5E0BA2789DD9"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="output-compare-ocmp">
<h1 class="title topictitle1" id="ariaid-title1">Output Compare (OCMP)</h1><div class="body"><p class="p">The Output Compare module is primarily used to generate a single pulse or a series of pulses in response to selected time base events. Each output compare module can select between one of six 16-bit timers for the time base, or two of six 16-bit timers together to form a 32-bit timer. The selected timer can use either an internal or external clock.</p>
<p class="p">Each Output Compare module has the following modes of operation (OCM bit field):
Single Compare Match Mode:</p>
<ul class="ul"><li class="li"><p class="p">With output drive high - Initial state of the pin is low. OCx pin becomes high on compare match.</p>
</li>
<li class="li"><p class="p">With output drive low - Initial state of the pin is high. OCx pin becomes low on compare match.</p>
</li>
<li class="li"><p class="p">With output drive toggles - OCx pin toggles on compare match.</p>
</li>
</ul>
<p class="p">Dual Compare Match Mode:</p>
<ul class="ul"><li class="li"><p class="p">With single output pulse - OCx pin becomes high on compare match and becomes low on secondary compare match</p>
</li>
<li class="li"><p class="p">With continuous output pulses - OCx pin becomes high on compare match and becomes low on secondary compare match continuously. Compare time base will count up to period value defined in the selected timer source module.</p>
</li>
</ul>
<p class="p">Pulse Width Modulation Mode:</p>
<ul class="ul"><li class="li"><p class="p">PWM without fault protection input - PWM duty cycle is defined by secondary compare register, OCxRS and PWM period is defined by selected timer period register (PRy)</p>
</li>
<li class="li"><p class="p">PWM with fault protection input - PWM duty cycle is defined by secondary compare register, OCxRS and PWM period is defined by selected timer period register (PRy). PWM outputs are shut asynchronously when fault condition is detected.</p>
</li>
</ul>
<p class="p"><strong class="ph b">Using The Library</strong></p>
<p class="p">This peripheral library is used to generate a single pulse or continuous pulses. The OCMP module needs the TMR module to provide the time base. The period value is defined in the TMR module and the compare value is defined in the OCMP module.</p>
<p class="p">In this application, three OCMP modules are used to generate waveforms.</p>
<p class="p">Active Low Output: By default output is set as high and it is set as low on the compare match</p>
<p class="p">Active High Output: By default output is set as low and it is set as high on the compare match</p>
<p class="p">Toggled Output: Compare match toggles the output.</p>
<pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d476672e56', this);">Copy</button><code id="d476672e56" content="int main ( void )&#xA;{&#xA;    /* Initialize all modules */&#xA;    SYS_Initialize ( NULL );&#xA;    &#xA;    /* Active low output */&#xA;    OCMP1_Enable();&#xA;    /* Active high output */&#xA;    OCMP2_Enable();&#xA;    /* toggled output */&#xA;    OCMP3_Enable();&#xA;&#xA;    TMR2_Start();    &#xA;&#xA;    while ( true )&#xA;    {&#xA;        /* Maintain state machines of all polled MPLAB Harmony modules. */&#xA;        SYS_Tasks ( );&#xA;    }&#xA;&#xA;    /* Execution should not come here during normal operation */&#xA;&#xA;    return ( EXIT_FAILURE );&#xA;}"><span class="ph token keyword">int</span> main <span class="ph token punctuation">(</span> <span class="ph token keyword">void</span> <span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    <span class="ph token comment">/* Initialize all modules */</span>
    SYS_Initialize <span class="ph token punctuation">(</span> <span class="ph token constant">NULL</span> <span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
    
    <span class="ph token comment">/* Active low output */</span>
    <span class="ph token function">OCMP1_Enable</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
    <span class="ph token comment">/* Active high output */</span>
    <span class="ph token function">OCMP2_Enable</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
    <span class="ph token comment">/* toggled output */</span>
    <span class="ph token function">OCMP3_Enable</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

    <span class="ph token function">TMR2_Start</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>    

    <span class="ph token keyword">while</span> <span class="ph token punctuation">(</span> true <span class="ph token punctuation">)</span>
    <span class="ph token punctuation">{</span>
        <span class="ph token comment">/* Maintain state machines of all polled MPLAB Harmony modules. */</span>
        SYS_Tasks <span class="ph token punctuation">(</span> <span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
    <span class="ph token punctuation">}</span>

    <span class="ph token comment">/* Execution should not come here during normal operation */</span>

    <span class="ph token keyword">return</span> <span class="ph token punctuation">(</span> EXIT_FAILURE <span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
<span class="ph token punctuation">}</span></code></pre><p class="p"><strong class="ph b">Library Interface</strong></p>
<p class="p">Peripheral library provides the following interfaces:</p>
<p class="p"><strong class="ph b">Functions</strong></p>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d476672e193"><span>Name</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d476672e195"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e193 "><span>OCMPx_Initialize</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e195 "><span>Initializes OCMPx module of the device</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e193 "><span>OCMPx_Enable</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e195 "><span>Enable function for the OCMPx peripheral</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e193 "><span>OCMPx_Disable</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e195 "><span>Disable function for the OCMPx peripheral</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e193 "><span>OCMPx_FaultStatusGet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e195 "><span>Reads the fault status</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e193 "><span>OCMPx_CompareValueSet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e195 "><span>Configures the compare register</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e193 "><span>OCMPx_CompareValueGet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e195 "><span>Reads the compare value</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e193 "><span>OCMPx_CompareSecondaryValueGet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e195 "><span>Reads secondary compare register</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e193 "><span>OCMPx_CompareSecondaryValueSet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e195 "><span>Sets OCMPx Secondary Compare Register</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e193 "><span>OCMPx_CallbackRegister</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e195 "><span>Registers the function to be called from interrupt</span></td>
</tr>
</tbody>
</table>
</div>
<p class="p"><strong class="ph b">Data types and constants</strong></p>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d476672e253"><span>Name</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d476672e255"><span>Type</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d476672e257"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e253 "><span>OCMP_CALLBACK</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e255 "><span>Typedef</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d476672e257 "><span>Defines the function pointer data type and function signature for the OCMP callback function</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</body>
</html>