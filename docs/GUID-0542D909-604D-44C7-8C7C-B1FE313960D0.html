<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="Pulse Width Modulation Controller (PWM)" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="pulse-width-modulation-controller-pwm" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>Pulse Width Modulation Controller (PWM)</title>
<meta name="Microsoft.Help.Id" content="GUID-1EA9B250-D935-443A-9FA9-C48E50D229E8-pulse-width-modulation-controller-pwm" />
<meta name="Microsoft.Help.TocParent" content="GUID-1EA9B250-D935-443A-9FA9-C48E50D229E8" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLAB® Harmony Peripheral Libraries Reference A 09/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-0542D909-604D-44C7-8C7C-B1FE313960D0"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="pulse-width-modulation-controller-pwm">
<h1 class="title topictitle1" id="ariaid-title1">Pulse Width Modulation Controller (PWM)</h1><div class="body"><p class="p">The Pulse Width Modulation Controller (PWM) generates output pulses on four channels independently according to parameters defined per channel. Each channel controls two complementary square output waveforms. Characteristics of the output waveforms such as period, duty-cycle, polarity and dead-times are configured through the user interface. Each channel selects and uses one of the clocks provided by the clock generator. The clock generator provides several clocks resulting from the division of the PWM peripheral clock. External triggers can be managed to allow output pulses to be modified in real time.
Channels can be linked together as synchronous channels to be able to update their duty-cycle or dead-time at the same time.
The PWM provides eight independent comparison units capable of comparing a programmed value to the counter of the synchronous channels (counter of channel 0). These comparisons are intended to generate software interrupts, to trigger pulses on the two independent event lines (in order to synchronize ADC conversions with a lot of flexibility independently of the PWM outputs) and to trigger DMA Controller transfer requests.
The PWM provides a fault protection mechanism with eight fault inputs, capable to detect a fault condition and to override the PWM outputs asynchronously (outputs forced to ‘0’, ‘1’ or Hi-Z).</p>
<p class="p"><strong class="ph b">Using The Library</strong></p>
<p class="p">This example shows how to configure the PWM to generate three phase PWM signals with dead time for a motor control application. The duty cycle of the PWM is updated in the interrupt handler.</p>
<pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d310382e17', this);">Copy</button><code id="d310382e17" content="/* Duty cycle increment value */&#xA;#define DUTY_INCREMENT (10U)&#xA;&#xA;/* Save PWM period */&#xA;uint16_t period;&#xA;&#xA;/* This function is called after PWM0 counter event */&#xA;void PWM_CounterEventHandler(uintptr_t context)&#xA;{&#xA;    static uint16_t duty0 = 0U;&#xA;    static uint16_t duty1 = 2500U;&#xA;    static uint16_t duty2 = 5000U;&#xA;&#xA;    PWMx_ChannelDutySet(PWM_CHANNEL_0, duty0);&#xA;    PWMx_ChannelDutySet(PWM_CHANNEL_1, duty1);&#xA;    PWMx_ChannelDutySet(PWM_CHANNEL_2, duty2);&#xA;&#xA;    /* Increment duty cycle values */&#xA;    duty0 += DUTY_INCREMENT;&#xA;    duty1 += DUTY_INCREMENT;&#xA;    duty2 += DUTY_INCREMENT;&#xA;&#xA;    if (duty0 &gt; period)&#xA;        duty0 = 0U;&#xA;    if (duty1 &gt; period)&#xA;        duty1 = 0U;&#xA;    if (duty2 &gt; period)&#xA;        duty2 = 0U;&#xA;}&#xA;&#xA;int main ( void )&#xA;{&#xA;    /* Register callback function for Channel 0 counter event */&#xA;    PWMx_CallbackRegister(PWM_CounterEventHandler, (uintptr_t)NULL);&#xA;&#xA;    /* Read the period */&#xA;    period = PWM0_ChannelPeriodGet(PWM_CHANNEL_0);&#xA;&#xA;    /* Start all synchronous channels by starting channel 0*/&#xA;    PWMx_ChannelsStart(PWM_CHANNEL_0_MASK);&#xA;}"><span class="ph token comment">/* Duty cycle increment value */</span>
<span class="ph token macro property">#<span class="ph token directive keyword">define</span> DUTY_INCREMENT (10U)</span>

<span class="ph token comment">/* Save PWM period */</span>
uint16_t period<span class="ph token punctuation">;</span>

<span class="ph token comment">/* This function is called after PWM0 counter event */</span>
<span class="ph token keyword">void</span> <span class="ph token function">PWM_CounterEventHandler</span><span class="ph token punctuation">(</span>uintptr_t context<span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    <span class="ph token keyword">static</span> uint16_t duty0 <span class="ph token operator">=</span> <span class="ph token number">0U</span><span class="ph token punctuation">;</span>
    <span class="ph token keyword">static</span> uint16_t duty1 <span class="ph token operator">=</span> <span class="ph token number">2500U</span><span class="ph token punctuation">;</span>
    <span class="ph token keyword">static</span> uint16_t duty2 <span class="ph token operator">=</span> <span class="ph token number">5000U</span><span class="ph token punctuation">;</span>

    <span class="ph token function">PWMx_ChannelDutySet</span><span class="ph token punctuation">(</span>PWM_CHANNEL_0<span class="ph token punctuation">,</span> duty0<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
    <span class="ph token function">PWMx_ChannelDutySet</span><span class="ph token punctuation">(</span>PWM_CHANNEL_1<span class="ph token punctuation">,</span> duty1<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
    <span class="ph token function">PWMx_ChannelDutySet</span><span class="ph token punctuation">(</span>PWM_CHANNEL_2<span class="ph token punctuation">,</span> duty2<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

    <span class="ph token comment">/* Increment duty cycle values */</span>
    duty0 <span class="ph token operator">+=</span> DUTY_INCREMENT<span class="ph token punctuation">;</span>
    duty1 <span class="ph token operator">+=</span> DUTY_INCREMENT<span class="ph token punctuation">;</span>
    duty2 <span class="ph token operator">+=</span> DUTY_INCREMENT<span class="ph token punctuation">;</span>

    <span class="ph token keyword">if</span> <span class="ph token punctuation">(</span>duty0 <span class="ph token operator">&gt;</span> period<span class="ph token punctuation">)</span>
        duty0 <span class="ph token operator">=</span> <span class="ph token number">0U</span><span class="ph token punctuation">;</span>
    <span class="ph token keyword">if</span> <span class="ph token punctuation">(</span>duty1 <span class="ph token operator">&gt;</span> period<span class="ph token punctuation">)</span>
        duty1 <span class="ph token operator">=</span> <span class="ph token number">0U</span><span class="ph token punctuation">;</span>
    <span class="ph token keyword">if</span> <span class="ph token punctuation">(</span>duty2 <span class="ph token operator">&gt;</span> period<span class="ph token punctuation">)</span>
        duty2 <span class="ph token operator">=</span> <span class="ph token number">0U</span><span class="ph token punctuation">;</span>
<span class="ph token punctuation">}</span>

<span class="ph token keyword">int</span> main <span class="ph token punctuation">(</span> <span class="ph token keyword">void</span> <span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    <span class="ph token comment">/* Register callback function for Channel 0 counter event */</span>
    <span class="ph token function">PWMx_CallbackRegister</span><span class="ph token punctuation">(</span>PWM_CounterEventHandler<span class="ph token punctuation">,</span> <span class="ph token punctuation">(</span>uintptr_t<span class="ph token punctuation">)</span><span class="ph token constant">NULL</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

    <span class="ph token comment">/* Read the period */</span>
    period <span class="ph token operator">=</span> <span class="ph token function">PWM0_ChannelPeriodGet</span><span class="ph token punctuation">(</span>PWM_CHANNEL_0<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

    <span class="ph token comment">/* Start all synchronous channels by starting channel 0*/</span>
    <span class="ph token function">PWMx_ChannelsStart</span><span class="ph token punctuation">(</span>PWM_CHANNEL_0_MASK<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
<span class="ph token punctuation">}</span></code></pre><p class="p"><strong class="ph b">Library Interface</strong></p>
<p class="p">Pulse Width Modulation Controller peripheral library provides the following interfaces:</p>
<p class="p"><strong class="ph b">Functions</strong></p>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d310382e303"><span>Name</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d310382e305"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e303 "><span>PWMx_Initialize</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e305 "><span>Initializes given instance of PWM peripheral</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e303 "><span>PWMx_ChannelsStart</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e305 "><span>Starts the given PWM channels</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e303 "><span>PWMx_ChannelsStop</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e305 "><span>Stops the given PWM channels</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e303 "><span>PWMx_ChannelPeriodSet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e305 "><span>Sets the period value of given PWM channel</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e303 "><span>PWMx_ChannelPeriodGet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e305 "><span>Reads the period value of given PWM channel</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e303 "><span>PWMx_ChannelDutySet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e305 "><span>Writes the duty cycle value of given PWM channel</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e303 "><span>PWMx_ChannelDeadTimeSet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e305 "><span>Writes dead time values of given PWM channel</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e303 "><span>PWMx_CompareValueSet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e305 "><span>Writes the compare value for given PWM peripheral and given comparison unit</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e303 "><span>PWMx_ChannelCounterEventEnable</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e305 "><span>Enables counter event of given channels</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e303 "><span>PWMx_ChannelCounterEventDisable</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e305 "><span>Disables counter event of given channels</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e303 "><span>PWMx_ChannelCounterEventStatusGet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e305 "><span>Disables counter event of given channels</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e303 "><span>PWMx_SyncUpdateEnable</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e305 "><span>This sets the synchronous update unlock bit</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e303 "><span>PWMx_FaultStatusClear</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e305 "><span>This function clears the status of the given fault id</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e303 "><span>PWMx_CallbackRegister</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e305 "><span>Registers the function to be called from interrupt</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e303 "><span>PWMx_ChannelOverrideEnable</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e305 "><span>This function overrides the PWM output</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e303 "><span>PWMx_ChannelOverrideDisable</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e305 "><span>This function select dead-time output as the PWM output</span></td>
</tr>
</tbody>
</table>
</div>
<p class="p"><strong class="ph b">Data types and constants</strong></p>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d310382e399"><span>Name</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d310382e401"><span>Type</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d310382e403"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e399 "><span>PWM_CALLBACK</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e401 "><span>Typedef</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e403 "><span>Defines the data type and function signature for the PWM peripheral callback function</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e399 "><span>PWM_CHANNEL_NUM</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e401 "><span>Enum</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e403 "><span>Identifies PWM channel number in a PWM peripheral</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e399 "><span>PWM_CHANNEL_MASK</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e401 "><span>Enum</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e403 "><span>Identifies PWM channel mask</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e399 "><span>PWM_COMPARE</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e401 "><span>Enum</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e403 "><span>Identifies PWM compare unit</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e399 "><span>PWM_FAULT_ID</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e401 "><span>Enum</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d310382e403 "><span>Identifies PWM fault input ids</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</body>
</html>