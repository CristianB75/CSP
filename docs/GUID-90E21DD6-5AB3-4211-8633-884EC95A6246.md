# Flash Write Control \(FCW\)

The FCW module provides interface to the device's Flash controller, so that memory pages can be written, read, erased in a standardized manner.

**Using The Library**

The main Flash memory can not be read while it is being erased or written, the CPU is stalled during the entire operation. All functions that modify the main Flash can be run from RAM memory to avoid CPU stall while main Flash is being erased or written.

FCW APIs are implemented to be non-blocking, the API will return immediately if not stalled by Flash operation. The user application can either poll the status or get callback once the flash operation is completed.

-   With polling, the application will need to continuously check if the flash operation is completed

-   With callback, the registered callback function will be called once the flash operation is completed. This means the application do not have to poll continuously. The interrupt must be enabled in MHC for callback method


Here is an example code to erase a page and program a row of memory using polling method

```c
#define APP_FLASH_ADDRESS  (FCW_FLASH_START_ADDRESS + (FCW_FLASH_SIZE / 2))

uint8_t CACHE_ALIGN rowBuffer[FCW_FLASH_ROWSIZE] = {0};

void populate_buffer(uint8_t* data)
{
    int i = 0;

    for (i = 0; i < (FCW_FLASH_ROWSIZE); i++)
    {
        *(data + i) = i;
    }
}

int main (void)
{
    /*Populate rowBuffer to programmed*/
    populate_buffer(rowBuffer);

    while(FCW_IsBusy());

    /* Erase the page */
    FCW_PageErase(APP_FLASH_ADDRESS);

    /* Wait for page erase  to complete */
    while(FCW_IsBusy());

    /* Program a row of data */
    FCW_RowWrite((uint32_t *)rowBuffer, APP_FLASH_ADDRESS);

    /* Wait for row program to compete */
    while(FCW_IsBusy());
}

```

**Library Interface**

Flash Write Control \(FCW\) peripheral library provides the following interfaces:

**Functions**

|Name|Description|
|----|-----------|
|FCW\_Initialize|Initializes given instance of the FCW peripheral|
|FCW\_Read|Reads length number of bytes from a given address in FLASH memory|
|FCW\_RowWrite|Writes one row of data to given FCW address|
|FCW\_SingleDoubleWordWrite|Writes Two Words into the Flash|
|FCW\_QuadDoubleWordWrite|Writes Eight Words into the Flash|
|FCW\_PageErase|Erases a Page in the FCW|
|FCW\_ErrorGet|Returns the error state of FCW controller|
|FCW\_IsBusy|Returns the current status of FCW controller|
|FCW\_CallbackRegister|Sets the pointer to the function \(and it's context\) to be called when the operation is complete|
|FCW\_ProgramFlashBankSelect|Selects program flash bank|
|FCW\_ProgramFlashBankGet|Returns selected program flash bank|
|FCW\_PFM\_WriteProtectRegionSetup|Creates program flash region|
|FCW\_PFM\_WriteProtectEnable|Enable write protection for program flash|
|FCW\_PFM\_WriteProtectDisable|Disable write protection for program flash|
|FCW\_PFM\_WriteProtectLock|Disable Writes to Program Flash Write Protect Lock register|
|FCW\_BootFlashWriteProtectEnable|Enable write protection for boot flash|
|FCW\_BootFlashWriteProtectDisable|Disable write protection for boot flash|
|FCW\_BootFlashWriteProtectLock|Disable Writes to boot Flash Write Protect register|

**Data types and constants**

|Name|Type|Description|
|----|----|-----------|
|FCW\_ERROR|Enum|Defines the FCW Error Type|
|PROGRAM\_FLASH\_BANK|Enum|Defines program flash bank|
|BOOT\_FLASH\_BANK|Enum|Defines boot flash bank|
|FCW\_BOOT\_FLASH\_WRITE\_PROTECT|Enum|Defines boot flash write protect page|
|PFM\_WP\_REGION|Enum|Defines PFM write protect region|
|PFM\_WP\_REGION\_SETUP|Struct|PFM write protect region Setup Structure|
|FCW\_CALLBACK|Typedef|Defines the data type and function signature for the FCW peripheral callback function|

-   **[FCW\_Initialize Function](GUID-9CFA05C2-CA39-4794-B903-F388EF5D1C70.md)**  

-   **[FCW\_Read Function](GUID-428C550A-E9CC-406F-952E-E7AD396C7662.md)**  

-   **[FCW\_RowWrite Function](GUID-71CCB4B7-EA80-475B-A305-721E32C3A5CE.md)**  

-   **[FCW\_SingleDoubleWordWrite Function](GUID-275FFCA3-3257-4E7F-8FE4-37B51227E55F.md)**  

-   **[FCW\_QuadDoubleWordWrite Function](GUID-825825DF-46D7-4AE7-A202-AC5975473BE9.md)**  

-   **[FCW\_PageErase Function](GUID-E6DB66D4-8789-409F-8C7B-76A53D1BD6F4.md)**  

-   **[FCW\_ErrorGet Function](GUID-B468A834-3C88-42F1-A3B1-3AD28305F99D.md)**  

-   **[FCW\_IsBusy Function](GUID-57A44E2D-F0E6-49F7-8FE3-3AAB9F8BB0F5.md)**  

-   **[FCW\_CallbackRegister Function](GUID-AE617D3C-45DC-4A89-BEE6-D059C579415A.md)**  

-   **[FCW\_ProgramFlashBankSelect Function](GUID-96BC133C-07C1-45E7-ADC4-2C53C809C66C.md)**  

-   **[FCW\_ProgramFlashBankGet Function](GUID-EE32F01E-746C-43FB-A6F7-A8C500F1A115.md)**  

-   **[FCW\_PFM\_WriteProtectRegionSetup Function](GUID-15357178-025B-4EE3-82FA-4CD685077D51.md)**  

-   **[FCW\_PFM\_WriteProtectEnable Function](GUID-CECCD90E-89B3-4062-BB3A-82023651AEA9.md)**  

-   **[FCW\_PFM\_WriteProtectDisable Function](GUID-190A34C2-3443-47D0-A2E2-63CF7B6830CA.md)**  

-   **[FCW\_PFM\_WriteProtectLock Function](GUID-D6B4060E-1FFE-4454-9654-14D195DA7890.md)**  

-   **[FCW\_BootFlashWriteProtectEnable Function](GUID-31DE6844-38C9-48C8-9BF9-C1F0B91E343B.md)**  

-   **[FCW\_BootFlashWriteProtectDisable Function](GUID-A58B0D4A-736E-4D19-AC47-F4221A5BD93A.md)**  

-   **[FCW\_BootFlashWriteProtectLock Function](GUID-F0518A8C-9447-4804-8FFF-CAA69851806F.md)**  

-   **[FCW\_ERROR Enum](GUID-3C67C655-7D02-47B5-860D-F5A14AC89DDD.md)**  

-   **[PROGRAM\_FLASH\_BANK Enum](GUID-EB5F0D8D-420E-4B3B-84FA-B656BE6E09F7.md)**  

-   **[BOOT\_FLASH\_BANK Enum](GUID-A748FB24-3B66-4350-BD95-1C478CA25EFF.md)**  

-   **[FCW\_BOOT\_FLASH\_WRITE\_PROTECT Enum](GUID-6AE4A9FB-A7EE-4208-888D-BDB2A6A87D27.md)**  

-   **[PFM\_WP\_REGION Enum](GUID-0632A0DE-9777-453B-B61A-2C825452B46C.md)**  

-   **[PFM\_WP\_REGION\_SETUP Struct](GUID-A35B0E2F-5460-424D-8C7D-F19ED06005E0.md)**  

-   **[FCW\_CALLBACK Typedef](GUID-0E2D3436-AB08-4A07-9408-396970DDC542.md)**  


**Parent topic:**[PIC32CZ-CA Peripheral Libraries](GUID-7EAC3718-3D58-4007-AB2A-A0E3C167A2DF.md)

