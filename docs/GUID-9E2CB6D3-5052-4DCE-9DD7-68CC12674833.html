<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="Controller Area Network (CAN)" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="controller-area-network-can" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>Controller Area Network (CAN)</title>
<meta name="Microsoft.Help.Id" content="GUID-1EA9B250-D935-443A-9FA9-C48E50D229E8-controller-area-network-can" />
<meta name="Microsoft.Help.TocParent" content="GUID-1EA9B250-D935-443A-9FA9-C48E50D229E8" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony Peripheral Libraries Reference A 09/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-9E2CB6D3-5052-4DCE-9DD7-68CC12674833"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="controller-area-network-can">
<h1 class="title topictitle1" id="ariaid-title1">Controller Area Network (CAN)</h1><div class="body"><p class="p">The Controller Area Network with Flexible Data-rate (CAN FD) module
supports the following key features:</p>
<p class="p">Standards Compliance:</p>
<ul class="ul"><li class="li"><p class="p">Full CAN 2.0B compliance</p>
</li>
<li class="li"><p class="p">Programmable bit rate</p>
</li>
<li class="li"><p class="p">ISO118981:2015 plus CAN FD 1.0 compliant, supports up to 64
data bytes payload/message</p>
</li>
<li class="li"><p class="p">Arbitration Bit Rate up to one Mbps</p>
</li>
<li class="li"><p class="p">FD Bit Rate up to eight Mbps
Message Reception and Transmission:</p>
</li>
<li class="li"><p class="p">32 message FIFOs</p>
</li>
<li class="li"><p class="p">Each FIFO can have up to 32 messages for a total of 512 messages</p>
</li>
<li class="li"><p class="p">FIFO can be a transmit message FIFO or a receive message FIFO</p>
</li>
<li class="li"><p class="p">Userdefined priority levels for message FIFOs used for
transmission</p>
</li>
<li class="li"><p class="p">32 acceptance filters for message filtering</p>
</li>
<li class="li"><p class="p">32 acceptance filter mask registers for message filtering</p>
</li>
<li class="li"><p class="p">Automatic response to Remote Transmit Request (RTR)</p>
</li>
</ul>
<p class="p"><strong class="ph b">Using The Library</strong></p>
<p class="p">The CAN library supports the CAN FD and CAN Classic (Normal) mode. The
CAN FD and CAN Classic (Normal) mode can transfer message in a polling
or an interrupt mode.</p>
<p class="p"><strong class="ph b">CAN FD operation with polling</strong></p>
<p class="p">The following example shows the CAN FD mode operation with polling
implementation.</p>
<pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d227352e62', this);">Copy</button><code id="d227352e62" content="void print_menu(void)&#xA;&#xA;{&#xA;&#xA;printf(&#34;Menu :\\r\\n&#34;&#xA;&#xA;&#34; -- Select the action:\\r\\n&#34;&#xA;&#xA;&#34; 1: Send FD standard message with ID: 0x45A and 64 byte data 0 to 63.&#xA;\\r\\n&#34;&#xA;&#xA;&#34; 2: Send normal standard message with ID: 0x469 and 8 byte data 0 to&#xA;\7. \\r\\n&#34;&#xA;&#xA;&#34; 3: To receive CAN FD or Normal message \\r\\n&#34;&#xA;&#xA;&#34; m: Display menu \\r\\n\\r\\n&#34;);&#xA;&#xA;}&#xA;&#xA;&#xA;&#xA;int main ( void )&#xA;{&#xA;&#xA;uint32_t messageID = 0;&#xA;&#xA;uint32_t rx_messageID = 0;&#xA;&#xA;uint32_t status = 0;&#xA;&#xA;uint8_t messageLength = 0;&#xA;&#xA;uint8_t rx_messageLength = 0;&#xA;&#xA;uint8_t count = 0;&#xA;&#xA;uint8_t user_input = 0;&#xA;&#xA;CANFD_MSG_RX_ATTRIBUTE msgAttr = CANFD_MSG_RX_DATA_FRAME;&#xA;&#xA;&#xA;&#xA;/* Initialize all modules */&#xA;&#xA;SYS_Initialize ( NULL );&#xA;&#xA;&#xA;&#xA;printf(&#34; ------------------------------ \\r\\n&#34;);&#xA;&#xA;printf(&#34; CAN FD Demo \\r\\n&#34;);&#xA;&#xA;printf(&#34; ------------------------------ \\r\\n&#34;);&#xA;&#xA;&#xA;&#xA;print_menu();&#xA;&#xA;&#xA;&#xA;/* Prepare the message to send*/&#xA;&#xA;for (count = 0; count \&lt; 64; count++)&#xA;&#xA;{&#xA;&#xA;message[count] = count;&#xA;&#xA;}&#xA;&#xA;&#xA;&#xA;while ( true )&#xA;&#xA;{&#xA;&#xA;/* Maintain state machines of all polled Harmony modules. */&#xA;&#xA;/* Check if there is a received character */&#xA;&#xA;if(UART2_ReceiverIsReady() == true)&#xA;&#xA;{&#xA;&#xA;if(UART2_ErrorGet() == UART_ERROR_NONE)&#xA;&#xA;{&#xA;&#xA;UART2_Read((void *)&amp;amp;user_input, 1);&#xA;&#xA;}&#xA;&#xA;switch (user_input)&#xA;&#xA;{&#xA;&#xA;case '1':&#xA;&#xA;printf(&#34; Transmitting CAN FD Message:&#34;);&#xA;&#xA;messageID = 0x45A;&#xA;&#xA;messageLength = 64;&#xA;&#xA;if (CAN1_MessageTransmit(messageID, messageLength, message, 1,&#xA;CANFD_MODE_FD_WITH_BRS, CANFD_MSG_TX_DATA_FRAME) == true)&#xA;&#xA;{&#xA;&#xA;printf(&#34;Success \\r\\n&#34;);&#xA;&#xA;LED_Toggle();&#xA;&#xA;}&#xA;&#xA;else&#xA;&#xA;{&#xA;&#xA;printf(&#34;Failed \\r\\n&#34;);&#xA;&#xA;}&#xA;&#xA;break;&#xA;&#xA;case '2':&#xA;&#xA;printf(&#34; Transmitting CAN Normal Message:&#34;);&#xA;&#xA;messageID = 0x469;&#xA;&#xA;messageLength = 8;&#xA;&#xA;if (CAN1_MessageTransmit(messageID, messageLength, message, 1,&#xA;CANFD_MODE_NORMAL, CANFD_MSG_TX_DATA_FRAME) == true)&#xA;&#xA;{&#xA;&#xA;printf(&#34;Success \\r\\n&#34;);&#xA;&#xA;LED_Toggle();&#xA;&#xA;}&#xA;&#xA;else&#xA;&#xA;{&#xA;&#xA;printf(&#34;Failed \\r\\n&#34;);&#xA;&#xA;}&#xA;&#xA;break;&#xA;&#xA;case '3':&#xA;&#xA;printf(&#34; Waiting for message: \\r\\n&#34;);&#xA;&#xA;while (true)&#xA;&#xA;{&#xA;&#xA;if (CAN1_InterruptGet(2, CANFD_FIFO_INTERRUPT_TFNRFNIF_MASK))&#xA;&#xA;{&#xA;&#xA;/* Check CAN Status */&#xA;&#xA;status = CAN1_ErrorGet();&#xA;&#xA;&#xA;&#xA;if (status == CANFD_ERROR_NONE)&#xA;&#xA;{&#xA;&#xA;memset(rx_message, 0x00, sizeof(rx_message));&#xA;&#xA;&#xA;&#xA;/* Receive New Message */&#xA;&#xA;if (CAN1_MessageReceive(&amp;amp;rx_messageID, &amp;amp;rx_messageLength,&#xA;rx_message, 0, 2, &amp;amp;msgAttr) == true)&#xA;&#xA;{&#xA;&#xA;printf(&#34; New Message Received \\r\\n&#34;);&#xA;&#xA;status = CAN1_ErrorGet();&#xA;&#xA;if (status == CANFD_ERROR_NONE)&#xA;&#xA;{&#xA;&#xA;/* Print message to Console */&#xA;&#xA;uint8_t length = rx_messageLength;&#xA;&#xA;printf(&#34; Message - ID : 0x%x Length : 0x%x &#34;, (unsigned int)&#xA;rx_messageID,(unsigned int) rx_messageLength);&#xA;&#xA;printf(&#34;Message : &#34;);&#xA;&#xA;while(length)&#xA;&#xA;{&#xA;&#xA;printf(&#34;0x%x &#34;, rx_message[rx_messageLength - length--]);&#xA;&#xA;}&#xA;&#xA;printf(&#34;\\r\\n&#34;);&#xA;&#xA;LED_Toggle();&#xA;&#xA;break;&#xA;&#xA;}&#xA;&#xA;else&#xA;&#xA;{&#xA;&#xA;printf(&#34;Error in received message&#34;);&#xA;&#xA;}&#xA;&#xA;}&#xA;&#xA;else&#xA;&#xA;{&#xA;&#xA;printf(&#34;Message Reception Failed \\r&#34;);&#xA;&#xA;}&#xA;&#xA;}&#xA;&#xA;else&#xA;&#xA;{&#xA;&#xA;printf(&#34;Error in last received message&#34;);&#xA;&#xA;}&#xA;&#xA;}&#xA;&#xA;}&#xA;&#xA;break;&#xA;&#xA;default:&#xA;&#xA;printf(&#34; Invalid Input \\r\\n&#34;);&#xA;&#xA;break;&#xA;&#xA;}&#xA;&#xA;print_menu();&#xA;&#xA;}&#xA;&#xA;}&#xA;&#xA;&#xA;&#xA;/* Execution should not come here during normal operation */&#xA;&#xA;&#xA;&#xA;return ( EXIT_FAILURE );&#xA;&#xA;}"><span class="ph token keyword">void</span> <span class="ph token function">print_menu</span><span class="ph token punctuation">(</span><span class="ph token keyword">void</span><span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">"Menu :\\r\\n"</span>

<span class="ph token string">" -- Select the action:\\r\\n"</span>

" <span class="ph token number">1</span><span class="ph token operator">:</span> Send FD standard message with ID<span class="ph token operator">:</span> <span class="ph token number">0x45A</span> and <span class="ph token number">64</span> byte data <span class="ph token number">0</span> to <span class="ph token number">63.</span>
\\r\\n"

" <span class="ph token number">2</span><span class="ph token operator">:</span> Send normal standard message with ID<span class="ph token operator">:</span> <span class="ph token number">0x469</span> and <span class="ph token number">8</span> byte data <span class="ph token number">0</span> to
\<span class="ph token number">7.</span> \\r\\n"

<span class="ph token string">" 3: To receive CAN FD or Normal message \\r\\n"</span>

<span class="ph token string">" m: Display menu \\r\\n\\r\\n"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>



<span class="ph token keyword">int</span> main <span class="ph token punctuation">(</span> <span class="ph token keyword">void</span> <span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>

uint32_t messageID <span class="ph token operator">=</span> <span class="ph token number">0</span><span class="ph token punctuation">;</span>

uint32_t rx_messageID <span class="ph token operator">=</span> <span class="ph token number">0</span><span class="ph token punctuation">;</span>

uint32_t status <span class="ph token operator">=</span> <span class="ph token number">0</span><span class="ph token punctuation">;</span>

uint8_t messageLength <span class="ph token operator">=</span> <span class="ph token number">0</span><span class="ph token punctuation">;</span>

uint8_t rx_messageLength <span class="ph token operator">=</span> <span class="ph token number">0</span><span class="ph token punctuation">;</span>

uint8_t count <span class="ph token operator">=</span> <span class="ph token number">0</span><span class="ph token punctuation">;</span>

uint8_t user_input <span class="ph token operator">=</span> <span class="ph token number">0</span><span class="ph token punctuation">;</span>

CANFD_MSG_RX_ATTRIBUTE msgAttr <span class="ph token operator">=</span> CANFD_MSG_RX_DATA_FRAME<span class="ph token punctuation">;</span>



<span class="ph token comment">/* Initialize all modules */</span>

SYS_Initialize <span class="ph token punctuation">(</span> <span class="ph token constant">NULL</span> <span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>



<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">" ------------------------------ \\r\\n"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">" CAN FD Demo \\r\\n"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">" ------------------------------ \\r\\n"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>



<span class="ph token function">print_menu</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>



<span class="ph token comment">/* Prepare the message to send*/</span>

<span class="ph token keyword">for</span> <span class="ph token punctuation">(</span>count <span class="ph token operator">=</span> <span class="ph token number">0</span><span class="ph token punctuation">;</span> count \<span class="ph token operator">&lt;</span> <span class="ph token number">64</span><span class="ph token punctuation">;</span> count<span class="ph token operator">++</span><span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

message<span class="ph token punctuation">[</span>count<span class="ph token punctuation">]</span> <span class="ph token operator">=</span> count<span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>



<span class="ph token keyword">while</span> <span class="ph token punctuation">(</span> true <span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token comment">/* Maintain state machines of all polled Harmony modules. */</span>

<span class="ph token comment">/* Check if there is a received character */</span>

<span class="ph token keyword">if</span><span class="ph token punctuation">(</span><span class="ph token function">UART2_ReceiverIsReady</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span> <span class="ph token operator">==</span> true<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token keyword">if</span><span class="ph token punctuation">(</span><span class="ph token function">UART2_ErrorGet</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span> <span class="ph token operator">==</span> UART_ERROR_NONE<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token function">UART2_Read</span><span class="ph token punctuation">(</span><span class="ph token punctuation">(</span><span class="ph token keyword">void</span> <span class="ph token operator">*</span><span class="ph token punctuation">)</span><span class="ph token operator">&amp;</span>user_input<span class="ph token punctuation">,</span> <span class="ph token number">1</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token keyword">switch</span> <span class="ph token punctuation">(</span>user_input<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token keyword">case</span> <span class="ph token string">'1'</span><span class="ph token operator">:</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">" Transmitting CAN FD Message:"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

messageID <span class="ph token operator">=</span> <span class="ph token number">0x45A</span><span class="ph token punctuation">;</span>

messageLength <span class="ph token operator">=</span> <span class="ph token number">64</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">if</span> <span class="ph token punctuation">(</span><span class="ph token function">CAN1_MessageTransmit</span><span class="ph token punctuation">(</span>messageID<span class="ph token punctuation">,</span> messageLength<span class="ph token punctuation">,</span> message<span class="ph token punctuation">,</span> <span class="ph token number">1</span><span class="ph token punctuation">,</span>
CANFD_MODE_FD_WITH_BRS<span class="ph token punctuation">,</span> CANFD_MSG_TX_DATA_FRAME<span class="ph token punctuation">)</span> <span class="ph token operator">==</span> true<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">"Success \\r\\n"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token function">LED_Toggle</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token keyword">else</span>

<span class="ph token punctuation">{</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">"Failed \\r\\n"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token keyword">break</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">case</span> <span class="ph token string">'2'</span><span class="ph token operator">:</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">" Transmitting CAN Normal Message:"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

messageID <span class="ph token operator">=</span> <span class="ph token number">0x469</span><span class="ph token punctuation">;</span>

messageLength <span class="ph token operator">=</span> <span class="ph token number">8</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">if</span> <span class="ph token punctuation">(</span><span class="ph token function">CAN1_MessageTransmit</span><span class="ph token punctuation">(</span>messageID<span class="ph token punctuation">,</span> messageLength<span class="ph token punctuation">,</span> message<span class="ph token punctuation">,</span> <span class="ph token number">1</span><span class="ph token punctuation">,</span>
CANFD_MODE_NORMAL<span class="ph token punctuation">,</span> CANFD_MSG_TX_DATA_FRAME<span class="ph token punctuation">)</span> <span class="ph token operator">==</span> true<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">"Success \\r\\n"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token function">LED_Toggle</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token keyword">else</span>

<span class="ph token punctuation">{</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">"Failed \\r\\n"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token keyword">break</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">case</span> <span class="ph token string">'3'</span><span class="ph token operator">:</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">" Waiting for message: \\r\\n"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">while</span> <span class="ph token punctuation">(</span>true<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token keyword">if</span> <span class="ph token punctuation">(</span><span class="ph token function">CAN1_InterruptGet</span><span class="ph token punctuation">(</span><span class="ph token number">2</span><span class="ph token punctuation">,</span> CANFD_FIFO_INTERRUPT_TFNRFNIF_MASK<span class="ph token punctuation">)</span><span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token comment">/* Check CAN Status */</span>

status <span class="ph token operator">=</span> <span class="ph token function">CAN1_ErrorGet</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>



<span class="ph token keyword">if</span> <span class="ph token punctuation">(</span>status <span class="ph token operator">==</span> CANFD_ERROR_NONE<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token function">memset</span><span class="ph token punctuation">(</span>rx_message<span class="ph token punctuation">,</span> <span class="ph token number">0x00</span><span class="ph token punctuation">,</span> <span class="ph token keyword">sizeof</span><span class="ph token punctuation">(</span>rx_message<span class="ph token punctuation">)</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>



<span class="ph token comment">/* Receive New Message */</span>

<span class="ph token keyword">if</span> <span class="ph token punctuation">(</span><span class="ph token function">CAN1_MessageReceive</span><span class="ph token punctuation">(</span><span class="ph token operator">&amp;</span>rx_messageID<span class="ph token punctuation">,</span> <span class="ph token operator">&amp;</span>rx_messageLength<span class="ph token punctuation">,</span>
rx_message<span class="ph token punctuation">,</span> <span class="ph token number">0</span><span class="ph token punctuation">,</span> <span class="ph token number">2</span><span class="ph token punctuation">,</span> <span class="ph token operator">&amp;</span>msgAttr<span class="ph token punctuation">)</span> <span class="ph token operator">==</span> true<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">" New Message Received \\r\\n"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

status <span class="ph token operator">=</span> <span class="ph token function">CAN1_ErrorGet</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">if</span> <span class="ph token punctuation">(</span>status <span class="ph token operator">==</span> CANFD_ERROR_NONE<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token comment">/* Print message to Console */</span>

uint8_t length <span class="ph token operator">=</span> rx_messageLength<span class="ph token punctuation">;</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">" Message - ID : 0x%x Length : 0x%x "</span><span class="ph token punctuation">,</span> <span class="ph token punctuation">(</span><span class="ph token keyword">unsigned</span> <span class="ph token keyword">int</span><span class="ph token punctuation">)</span>
rx_messageID<span class="ph token punctuation">,</span><span class="ph token punctuation">(</span><span class="ph token keyword">unsigned</span> <span class="ph token keyword">int</span><span class="ph token punctuation">)</span> rx_messageLength<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">"Message : "</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">while</span><span class="ph token punctuation">(</span>length<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">"0x%x "</span><span class="ph token punctuation">,</span> rx_message<span class="ph token punctuation">[</span>rx_messageLength <span class="ph token operator">-</span> length<span class="ph token operator">--</span><span class="ph token punctuation">]</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">"\\r\\n"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token function">LED_Toggle</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">break</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token keyword">else</span>

<span class="ph token punctuation">{</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">"Error in received message"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token punctuation">}</span>

<span class="ph token keyword">else</span>

<span class="ph token punctuation">{</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">"Message Reception Failed \\r"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token punctuation">}</span>

<span class="ph token keyword">else</span>

<span class="ph token punctuation">{</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">"Error in last received message"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token punctuation">}</span>

<span class="ph token punctuation">}</span>

<span class="ph token keyword">break</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">default</span><span class="ph token operator">:</span>

<span class="ph token function">printf</span><span class="ph token punctuation">(</span><span class="ph token string">" Invalid Input \\r\\n"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">break</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token function">print_menu</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token punctuation">}</span>



<span class="ph token comment">/* Execution should not come here during normal operation */</span>



<span class="ph token keyword">return</span> <span class="ph token punctuation">(</span> EXIT_FAILURE <span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span></code></pre><p class="p"><strong class="ph b">CAN FD operation with interrupt</strong></p>
<p class="p">The following example shows the CAN FD mode operation with interrupt
implementation.</p>
<pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d227352e1191', this);">Copy</button><code id="d227352e1191" content="/* Application's state machine enum */&#xA;&#xA;typedef enum&#xA;&#xA;{&#xA;&#xA;APP_STATE_CAN_RECEIVE,&#xA;&#xA;APP_STATE_CAN_TRANSMIT,&#xA;&#xA;APP_STATE_CAN_IDLE,&#xA;&#xA;APP_STATE_CAN_USER_INPUT,&#xA;&#xA;APP_STATE_CAN_XFER_SUCCESSFUL,&#xA;&#xA;APP_STATE_CAN_XFER_ERROR&#xA;&#xA;} APP_STATES;&#xA;&#xA;&#xA;&#xA;/* Variable to save application state */&#xA;&#xA;static APP_STATES state = APP_STATE_CAN_USER_INPUT;&#xA;&#xA;&#xA;&#xA;void APP_CAN_Callback(uintptr_t context)&#xA;&#xA;{&#xA;&#xA;xferContext = context;&#xA;&#xA;&#xA;&#xA;/* Check CAN Status */&#xA;&#xA;status = CAN1_ErrorGet();&#xA;&#xA;&#xA;&#xA;if ((status &amp;amp; (CANFD_ERROR_TX_RX_WARNING_STATE |&#xA;CANFD_ERROR_RX_WARNING_STATE |&#xA;&#xA;CANFD_ERROR_TX_WARNING_STATE | CANFD_ERROR_RX_BUS_PASSIVE_STATE |&#xA;&#xA;CANFD_ERROR_TX_BUS_PASSIVE_STATE | CANFD_ERROR_TX_BUS_OFF_STATE)) ==&#xA;CANFD_ERROR_NONE)&#xA;&#xA;{&#xA;&#xA;switch ((APP_STATES)context)&#xA;&#xA;{&#xA;&#xA;case APP_STATE_CAN_RECEIVE:&#xA;&#xA;case APP_STATE_CAN_TRANSMIT:&#xA;&#xA;{&#xA;&#xA;state = APP_STATE_CAN_XFER_SUCCESSFUL;&#xA;&#xA;break;&#xA;&#xA;}&#xA;&#xA;default:&#xA;&#xA;break;&#xA;&#xA;}&#xA;&#xA;}&#xA;&#xA;else&#xA;&#xA;{&#xA;&#xA;state = APP_STATE_CAN_XFER_ERROR;&#xA;&#xA;}&#xA;&#xA;}&#xA;&#xA;&#xA;&#xA;int main ( void )&#xA;{&#xA;&#xA;uint8_t count = 0;&#xA;&#xA;bool user_input = 0;&#xA;&#xA;&#xA;&#xA;/* Initialize all modules */&#xA;&#xA;SYS_Initialize ( NULL );&#xA;&#xA;&#xA;&#xA;/* Prepare the message to send*/&#xA;&#xA;messageID = 0x45A;&#xA;&#xA;messageLength = 64;&#xA;&#xA;for (count = 0; count \&lt; 64; count++)&#xA;&#xA;{&#xA;&#xA;message[count] = count;&#xA;&#xA;}&#xA;&#xA;&#xA;&#xA;while ( true )&#xA;&#xA;{&#xA;&#xA;if (state == APP_STATE_CAN_USER_INPUT)&#xA;&#xA;{&#xA;&#xA;if(SWITCH_Get() == SWITCH_PRESSED_STATE)&#xA;&#xA;{&#xA;&#xA;while(SWITCH_Get() == SWITCH_PRESSED_STATE);&#xA;&#xA;&#xA;&#xA;switch (user_input)&#xA;&#xA;{&#xA;&#xA;case 0:&#xA;&#xA;CAN1_CallbackRegister( APP_CAN_Callback,&#xA;(uintptr_t)APP_STATE_CAN_TRANSMIT, 1 );&#xA;&#xA;state = APP_STATE_CAN_IDLE;&#xA;&#xA;CAN1_MessageTransmit(messageID, messageLength, message, 1,&#xA;CANFD_MODE_FD_WITH_BRS, CANFD_MSG_TX_DATA_FRAME);&#xA;&#xA;break;&#xA;&#xA;case 1:&#xA;&#xA;CAN1_CallbackRegister( APP_CAN_Callback,&#xA;(uintptr_t)APP_STATE_CAN_RECEIVE, 2 );&#xA;&#xA;state = APP_STATE_CAN_IDLE;&#xA;&#xA;memset(rx_message, 0x00, sizeof(rx_message));&#xA;&#xA;/* Receive New Message */&#xA;&#xA;CAN1_MessageReceive(&amp;amp;rx_messageID, &amp;amp;rx_messageLength, rx_message,&#xA;0, 2, &amp;amp;msgAttr);&#xA;&#xA;break;&#xA;&#xA;default:&#xA;&#xA;break;&#xA;&#xA;}&#xA;&#xA;}&#xA;&#xA;else&#xA;&#xA;{&#xA;&#xA;continue;&#xA;&#xA;}&#xA;&#xA;}&#xA;&#xA;/* Check the application's current state. */&#xA;&#xA;switch (state)&#xA;&#xA;{&#xA;&#xA;case APP_STATE_CAN_IDLE:&#xA;&#xA;{&#xA;&#xA;/* Application can do other task here */&#xA;&#xA;break;&#xA;&#xA;}&#xA;&#xA;case APP_STATE_CAN_XFER_SUCCESSFUL:&#xA;&#xA;{&#xA;&#xA;if ((APP_STATES)xferContext == APP_STATE_CAN_RECEIVE)&#xA;&#xA;{&#xA;&#xA;}&#xA;&#xA;else if ((APP_STATES)xferContext == APP_STATE_CAN_TRANSMIT)&#xA;&#xA;{&#xA;&#xA;}&#xA;&#xA;LED_Toggle();&#xA;&#xA;state = APP_STATE_CAN_USER_INPUT;&#xA;&#xA;break;&#xA;&#xA;}&#xA;&#xA;case APP_STATE_CAN_XFER_ERROR:&#xA;&#xA;{&#xA;&#xA;if ((APP_STATES)xferContext == APP_STATE_CAN_RECEIVE)&#xA;&#xA;{&#xA;&#xA;}&#xA;&#xA;else&#xA;&#xA;{&#xA;&#xA;}&#xA;&#xA;state = APP_STATE_CAN_USER_INPUT;&#xA;&#xA;break;&#xA;&#xA;}&#xA;&#xA;default:&#xA;&#xA;break;&#xA;&#xA;}&#xA;&#xA;&#xA;&#xA;}&#xA;&#xA;&#xA;&#xA;/* Execution should not come here during normal operation */&#xA;&#xA;&#xA;&#xA;return ( EXIT_FAILURE );&#xA;}"><span class="ph token comment">/* Application's state machine enum */</span>

<span class="ph token keyword">typedef</span> <span class="ph token keyword">enum</span>

<span class="ph token punctuation">{</span>

APP_STATE_CAN_RECEIVE<span class="ph token punctuation">,</span>

APP_STATE_CAN_TRANSMIT<span class="ph token punctuation">,</span>

APP_STATE_CAN_IDLE<span class="ph token punctuation">,</span>

APP_STATE_CAN_USER_INPUT<span class="ph token punctuation">,</span>

APP_STATE_CAN_XFER_SUCCESSFUL<span class="ph token punctuation">,</span>

APP_STATE_CAN_XFER_ERROR

<span class="ph token punctuation">}</span> APP_STATES<span class="ph token punctuation">;</span>



<span class="ph token comment">/* Variable to save application state */</span>

<span class="ph token keyword">static</span> APP_STATES state <span class="ph token operator">=</span> APP_STATE_CAN_USER_INPUT<span class="ph token punctuation">;</span>



<span class="ph token keyword">void</span> <span class="ph token function">APP_CAN_Callback</span><span class="ph token punctuation">(</span>uintptr_t context<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

xferContext <span class="ph token operator">=</span> context<span class="ph token punctuation">;</span>



<span class="ph token comment">/* Check CAN Status */</span>

status <span class="ph token operator">=</span> <span class="ph token function">CAN1_ErrorGet</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>



<span class="ph token keyword">if</span> <span class="ph token punctuation">(</span><span class="ph token punctuation">(</span>status <span class="ph token operator">&amp;</span> <span class="ph token punctuation">(</span>CANFD_ERROR_TX_RX_WARNING_STATE <span class="ph token operator">|</span>
CANFD_ERROR_RX_WARNING_STATE <span class="ph token operator">|</span>

CANFD_ERROR_TX_WARNING_STATE <span class="ph token operator">|</span> CANFD_ERROR_RX_BUS_PASSIVE_STATE <span class="ph token operator">|</span>

CANFD_ERROR_TX_BUS_PASSIVE_STATE <span class="ph token operator">|</span> CANFD_ERROR_TX_BUS_OFF_STATE<span class="ph token punctuation">)</span><span class="ph token punctuation">)</span> <span class="ph token operator">==</span>
CANFD_ERROR_NONE<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token keyword">switch</span> <span class="ph token punctuation">(</span><span class="ph token punctuation">(</span>APP_STATES<span class="ph token punctuation">)</span>context<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token keyword">case</span> APP_STATE_CAN_RECEIVE<span class="ph token operator">:</span>

<span class="ph token keyword">case</span> APP_STATE_CAN_TRANSMIT<span class="ph token operator">:</span>

<span class="ph token punctuation">{</span>

state <span class="ph token operator">=</span> APP_STATE_CAN_XFER_SUCCESSFUL<span class="ph token punctuation">;</span>

<span class="ph token keyword">break</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token keyword">default</span><span class="ph token operator">:</span>

<span class="ph token keyword">break</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token punctuation">}</span>

<span class="ph token keyword">else</span>

<span class="ph token punctuation">{</span>

state <span class="ph token operator">=</span> APP_STATE_CAN_XFER_ERROR<span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token punctuation">}</span>



<span class="ph token keyword">int</span> main <span class="ph token punctuation">(</span> <span class="ph token keyword">void</span> <span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>

uint8_t count <span class="ph token operator">=</span> <span class="ph token number">0</span><span class="ph token punctuation">;</span>

bool user_input <span class="ph token operator">=</span> <span class="ph token number">0</span><span class="ph token punctuation">;</span>



<span class="ph token comment">/* Initialize all modules */</span>

SYS_Initialize <span class="ph token punctuation">(</span> <span class="ph token constant">NULL</span> <span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>



<span class="ph token comment">/* Prepare the message to send*/</span>

messageID <span class="ph token operator">=</span> <span class="ph token number">0x45A</span><span class="ph token punctuation">;</span>

messageLength <span class="ph token operator">=</span> <span class="ph token number">64</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">for</span> <span class="ph token punctuation">(</span>count <span class="ph token operator">=</span> <span class="ph token number">0</span><span class="ph token punctuation">;</span> count \<span class="ph token operator">&lt;</span> <span class="ph token number">64</span><span class="ph token punctuation">;</span> count<span class="ph token operator">++</span><span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

message<span class="ph token punctuation">[</span>count<span class="ph token punctuation">]</span> <span class="ph token operator">=</span> count<span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>



<span class="ph token keyword">while</span> <span class="ph token punctuation">(</span> true <span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token keyword">if</span> <span class="ph token punctuation">(</span>state <span class="ph token operator">==</span> APP_STATE_CAN_USER_INPUT<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token keyword">if</span><span class="ph token punctuation">(</span><span class="ph token function">SWITCH_Get</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span> <span class="ph token operator">==</span> SWITCH_PRESSED_STATE<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token keyword">while</span><span class="ph token punctuation">(</span><span class="ph token function">SWITCH_Get</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span> <span class="ph token operator">==</span> SWITCH_PRESSED_STATE<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>



<span class="ph token keyword">switch</span> <span class="ph token punctuation">(</span>user_input<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token keyword">case</span> <span class="ph token number">0</span><span class="ph token operator">:</span>

<span class="ph token function">CAN1_CallbackRegister</span><span class="ph token punctuation">(</span> APP_CAN_Callback<span class="ph token punctuation">,</span>
<span class="ph token punctuation">(</span>uintptr_t<span class="ph token punctuation">)</span>APP_STATE_CAN_TRANSMIT<span class="ph token punctuation">,</span> <span class="ph token number">1</span> <span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

state <span class="ph token operator">=</span> APP_STATE_CAN_IDLE<span class="ph token punctuation">;</span>

<span class="ph token function">CAN1_MessageTransmit</span><span class="ph token punctuation">(</span>messageID<span class="ph token punctuation">,</span> messageLength<span class="ph token punctuation">,</span> message<span class="ph token punctuation">,</span> <span class="ph token number">1</span><span class="ph token punctuation">,</span>
CANFD_MODE_FD_WITH_BRS<span class="ph token punctuation">,</span> CANFD_MSG_TX_DATA_FRAME<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">break</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">case</span> <span class="ph token number">1</span><span class="ph token operator">:</span>

<span class="ph token function">CAN1_CallbackRegister</span><span class="ph token punctuation">(</span> APP_CAN_Callback<span class="ph token punctuation">,</span>
<span class="ph token punctuation">(</span>uintptr_t<span class="ph token punctuation">)</span>APP_STATE_CAN_RECEIVE<span class="ph token punctuation">,</span> <span class="ph token number">2</span> <span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

state <span class="ph token operator">=</span> APP_STATE_CAN_IDLE<span class="ph token punctuation">;</span>

<span class="ph token function">memset</span><span class="ph token punctuation">(</span>rx_message<span class="ph token punctuation">,</span> <span class="ph token number">0x00</span><span class="ph token punctuation">,</span> <span class="ph token keyword">sizeof</span><span class="ph token punctuation">(</span>rx_message<span class="ph token punctuation">)</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token comment">/* Receive New Message */</span>

<span class="ph token function">CAN1_MessageReceive</span><span class="ph token punctuation">(</span><span class="ph token operator">&amp;</span>rx_messageID<span class="ph token punctuation">,</span> <span class="ph token operator">&amp;</span>rx_messageLength<span class="ph token punctuation">,</span> rx_message<span class="ph token punctuation">,</span>
<span class="ph token number">0</span><span class="ph token punctuation">,</span> <span class="ph token number">2</span><span class="ph token punctuation">,</span> <span class="ph token operator">&amp;</span>msgAttr<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">break</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">default</span><span class="ph token operator">:</span>

<span class="ph token keyword">break</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token punctuation">}</span>

<span class="ph token keyword">else</span>

<span class="ph token punctuation">{</span>

<span class="ph token keyword">continue</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token punctuation">}</span>

<span class="ph token comment">/* Check the application's current state. */</span>

<span class="ph token keyword">switch</span> <span class="ph token punctuation">(</span>state<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token keyword">case</span> APP_STATE_CAN_IDLE<span class="ph token operator">:</span>

<span class="ph token punctuation">{</span>

<span class="ph token comment">/* Application can do other task here */</span>

<span class="ph token keyword">break</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token keyword">case</span> APP_STATE_CAN_XFER_SUCCESSFUL<span class="ph token operator">:</span>

<span class="ph token punctuation">{</span>

<span class="ph token keyword">if</span> <span class="ph token punctuation">(</span><span class="ph token punctuation">(</span>APP_STATES<span class="ph token punctuation">)</span>xferContext <span class="ph token operator">==</span> APP_STATE_CAN_RECEIVE<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token punctuation">}</span>

<span class="ph token keyword">else</span> <span class="ph token keyword">if</span> <span class="ph token punctuation">(</span><span class="ph token punctuation">(</span>APP_STATES<span class="ph token punctuation">)</span>xferContext <span class="ph token operator">==</span> APP_STATE_CAN_TRANSMIT<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token punctuation">}</span>

<span class="ph token function">LED_Toggle</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

state <span class="ph token operator">=</span> APP_STATE_CAN_USER_INPUT<span class="ph token punctuation">;</span>

<span class="ph token keyword">break</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token keyword">case</span> APP_STATE_CAN_XFER_ERROR<span class="ph token operator">:</span>

<span class="ph token punctuation">{</span>

<span class="ph token keyword">if</span> <span class="ph token punctuation">(</span><span class="ph token punctuation">(</span>APP_STATES<span class="ph token punctuation">)</span>xferContext <span class="ph token operator">==</span> APP_STATE_CAN_RECEIVE<span class="ph token punctuation">)</span>

<span class="ph token punctuation">{</span>

<span class="ph token punctuation">}</span>

<span class="ph token keyword">else</span>

<span class="ph token punctuation">{</span>

<span class="ph token punctuation">}</span>

state <span class="ph token operator">=</span> APP_STATE_CAN_USER_INPUT<span class="ph token punctuation">;</span>

<span class="ph token keyword">break</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>

<span class="ph token keyword">default</span><span class="ph token operator">:</span>

<span class="ph token keyword">break</span><span class="ph token punctuation">;</span>

<span class="ph token punctuation">}</span>



<span class="ph token punctuation">}</span>



<span class="ph token comment">/* Execution should not come here during normal operation */</span>



<span class="ph token keyword">return</span> <span class="ph token punctuation">(</span> EXIT_FAILURE <span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
<span class="ph token punctuation">}</span></code></pre><p class="p"><strong class="ph b">Library Interface</strong></p>
<p class="p">peripheral library provides the following interfaces:</p>
<p class="p"><strong class="ph b">Functions</strong></p>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d227352e2070"><span>Name</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d227352e2072"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2070 "><span>CANx_Initialize</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2072 "><span>Initializes given instance of the CAN peripheral</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2070 "><span>CANx_MessageTransmit</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2072 "><span>Transmits a message into CAN bus</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2070 "><span>CANx_MessageReceive</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2072 "><span>Receives a message from CAN bus</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2070 "><span>CANx_MessageAbort</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2072 "><span>Abort request for a FIFO</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2070 "><span>CANx_MessageAcceptanceFilterSet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2072 "><span>Set Message acceptance filter configuration</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2070 "><span>CANx_MessageAcceptanceFilterGet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2072 "><span>Get Message acceptance filter configuration</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2070 "><span>CANx_MessageAcceptanceFilterMaskSet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2072 "><span>Set Message acceptance filter mask configuration</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2070 "><span>CANx_MessageAcceptanceFilterMaskGet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2072 "><span>Get Message acceptance filter mask configuration</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2070 "><span>CANx_TransmitEventFIFOElementGet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2072 "><span>Get the Transmit Event FIFO Element for the transmitted message</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2070 "><span>CANx_ErrorGet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2072 "><span>Returns the error during transfer</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2070 "><span>CANx_ErrorCountGet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2072 "><span>Returns the transmit and receive error count during transfer</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2070 "><span>CANx_InterruptGet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2072 "><span>Returns the FIFO Interrupt status</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2070 "><span>CANx_TxFIFOQueueIsFull</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2072 "><span>Returns true if Tx FIFO/Queue is full otherwise false</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2070 "><span>CANx_AutoRTRResponseSet</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2072 "><span>Set the Auto RTR response for remote transmit request</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2070 "><span>CANx_CallbackRegister</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2072 "><span>Sets the pointer to the function (and it's context) to be called when the given CAN's transfer events occur</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2070 "><span>CANx_ErrorCallbackRegister</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2072 "><span>Sets the pointer to the function (and it's context) to be called when error occurs in CAN</span></td>
</tr>
</tbody>
</table>
</div>
<p class="p"><strong class="ph b">Data types and constants</strong></p>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d227352e2166"><span>Name</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d227352e2168"><span>Type</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d227352e2170"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2166 "><span>CANFD_MODE</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2168 "><span>Enum</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2170 "><span>CANFD Mode for Classic CAN and CAN FD</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2166 "><span>CANFD_MSG_TX_ATTRIBUTE</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2168 "><span>Enum</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2170 "><span>CANFD Tx Message Attribute for Tx FIFO and Tx Queue</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2166 "><span>CANFD_MSG_RX_ATTRIBUTE</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2168 "><span>Enum</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2170 "><span>CANFD Message RX Attribute for Data Frame and Remote Frame</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2166 "><span>CANFD_FIFO_INTERRUPT_FLAG_MASK</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2168 "><span>Enum</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2170 "><span>CANFD FIFO Interrupt Status Flag Mask</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2166 "><span>CANFD_ERROR</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2168 "><span>Enum</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2170 "><span>CANFD Transfer Error data type</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2166 "><span>CANFD_CALLBACK</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2168 "><span>Typedef</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2170 "><span>CANFD Callback Function Pointer</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2166 "><span>CANFD_RX_MSG</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2168 "><span>Struct</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2170 "><span>CANFD RX Message Buffer structure</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2166 "><span>CANFD_RX_MSG_OBJECT</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2168 "><span>Struct</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2170 "><span>CANFD Receive Message Object structure</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2166 "><span>CANFD_TX_MSG_OBJECT</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2168 "><span>Struct</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2170 "><span>CANFD Transmit Message Object structure</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2166 "><span>CANFD_TX_EVENT_FIFO_ELEMENT</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2168 "><span>Struct</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d227352e2170 "><span>CANFD Trasmit Event FIFO Element structure</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</body>
</html>