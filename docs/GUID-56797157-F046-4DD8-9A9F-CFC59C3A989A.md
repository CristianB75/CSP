# Quad Serial Peripheral Interface \(QSPI\)

The Quad SPI Interface \(QSPI\) is a synchronous serial data link that provides communication with external devices in Master mode. It is similar to SPI protocol except that it has additional data lines.

The QSPI can be used in normal SPI mode or in Serial Memory mode to connect to external Flash memories. The normal SPI has four communication lines: Chip Select, Clock, MOSI, and MISO. For QSPI, additional data lines are available. The command/data/address are sent through single, dual or quad IO based on the mode selected.

As data is sent over multiple lines, it helps in increasing bandwidth compared to a standard SPI transfer. With the support of the Quad SPI protocol, the QSPI allows the system to use high-performance serial Flash memories which are small and inexpensive, in place of larger and more expensive parallel Flash memories.

The QSPI allows the system to execute code directly from a serial Flash memory \(XIP\) without code shadowing to RAM. The serial Flash memory<br />mapping is seen in the system as other memories such as SRAM, and FLASH memory.

**Using The Library**

The QSPI Peripheral Library operates in Serial Memory Mode or SPI Mode to interface with the QSPI based Serial Flash Memories operating in<br />Single-bit SPI, Dual SPI, and Quad SPI.

The QSPI Peripheral library provides non-Blocking API's, which can be used to perform the following functionalities on the QSPI Slave device.

-   **Send a command**

    -   qspi\_command\_xfer\_t data type needs to filled to send a command<br />to the slave device

-   **Register read/write**

    -   qspi\_register\_xfer\_t data type needs to be filled to read data<br />from a register or to write data to a register.

-   **Memory read/write**

    -   qspi\_memory\_xfer\_t data type needs to be filled to read data from<br />flash memory or to write data to the FLASH memory.


Here is an example code to read data from SST26 QSPI flash memory using QSPI peripheral

```c
#define SST26_HIGH_SPEED_READ 0x0B

static qspi_memory_xfer_t qspi_memory_xfer;
static uint32_t buffer[256];
uint32_t address = 0x0

memset((void *)&qspi_memory_xfer, 0, sizeof(qspi_memory_xfer_t));

// Read memory location starting from address 0x0
qspi_memory_xfer.instruction = SST26_HIGH_SPEED_READ;

// Use QAUD SPI Lane
qspi_memory_xfer.width = QUAD_CMD;
qspi_memory_xfer.dummy_cycles = 6;

if (QSPI0_MemoryRead(&qspi_memory_xfer, buffer, sizeof(buffer), address) == false)
{
    // Handle Error
}
```

**Library Interface**

Quad Serial Peripheral Interface peripheral library provides the following interfaces:

**Functions**

**QSPI Mode:**

|Name|Description|
|----|-----------|
|QSPIx\_Initialize|Initializes given instance of the QSPI peripheral|
|QSPIx\_CommandWrite|Writes command to QSPI slave device|
|QSPIx\_RegisterRead|Reads particular register of QSPI slave device|
|QSPIx\_RegisterWrite|Writes to particular register of QSPI slave device|
|QSPIx\_MemoryRead|Reads from the specified address of the serial flash device|
|QSPIx\_MemoryWrite|Writes to the specified address of the serial flash device|

**SPI Mode:**

|Name|Description|
|----|-----------|
|QSPIx\_Initialize|Initializes given instance of the QSPI peripheral|
|QSPIx\_TransferSetup|Setup QSPI operational parameters as desired by the client.|
|QSPIx\_WriteRead|Write and Read data on QSPI peripheral.|
|QSPIx\_Write|Write data on QSPI peripheral.|
|QSPIx\_Read|Read data on QSPI peripheral.|
|QSPIx\_IsBusy|Returns transfer status of QSPI peripheral.|
|QSPIx\_CallbackRegister|Allows application to register callback with PLIB.|

**Data types and constants**

|Name|Type|Description|
|----|----|-----------|
|QSPI\_ADDRESS\_LENGTH|Enum|Defines the data type to specify address length|
|QSPI\_LANE\_WIDTH|Enum|Defines the data type to specify lane width|
|QSPI\_OPTION\_LENGTH|Enum|Defines the data type to specify option length|
|QSPI\_CLOCK\_PHASE|Enum|Identifies QSPI Clock Phase Options|
|QSPI\_CLOCK\_POLARITY|Enum|Identifies QSPI Clock Polarity Options|
|QSPI\_DATA\_BITS|Enum|Identifies SPI bits per transfer|
|QSPI\_TRANSFER\_SETUP|Struct|Identifies the setup parameters which can be changed dynamically|
|qspi\_command\_xfer\_t|Struct|Defines the data type for the QSPI commands transfer|
|qspi\_register\_xfer\_t|Struct|Defines the data type for the QSPI register data transfer|
|qspi\_memory\_xfer\_t|Struct|Defines the data type for the QSPI memory transfer|
|QSPI\_CALLBACK|Typedef|Pointer to a Callback function. This is used in SPI mode only|

-   **[QSPIx\_Initialize Function](GUID-BCF71FA2-833F-4161-AFB5-7A5544CB162F.md)**  

-   **[QSPIx\_CommandWrite Function](GUID-A420CBA5-160F-4575-BC58-4DC907CA0378.md)**  

-   **[QSPIx\_RegisterRead Function](GUID-DBFCA5BF-9CB6-4B2B-AB10-EE64A38A7266.md)**  

-   **[QSPIx\_RegisterWrite Function](GUID-13150CE8-3A41-48A3-999F-1F329F046D1B.md)**  

-   **[QSPIx\_MemoryRead Function](GUID-2F6D1AB5-5A19-4C60-A0F3-408B43FB3144.md)**  

-   **[QSPIx\_MemoryWrite Function](GUID-CBE8728F-11EB-42B8-AD1E-06375459F82B.md)**  

-   **[QSPIx\_TransferSetup Function](GUID-96AD1ACD-1683-4D75-814E-414AC96E9450.md)**  

-   **[QSPIx\_WriteRead Function](GUID-E80F90F6-051F-45D8-BBF5-E802E425DC61.md)**  

-   **[QSPIx\_Write Function](GUID-A8D5526B-E30F-4C85-AB99-ABBF9FFAD4FA.md)**  

-   **[QSPIx\_Read Function](GUID-01C93495-36D6-40F9-A410-0B38A5C64B73.md)**  

-   **[QSPIx\_IsBusy Function](GUID-133F13DC-B500-4B0B-B0BD-C7E17C6F7C03.md)**  

-   **[QSPIx\_CallbackRegister Function](GUID-27218116-EA8F-4179-8D4B-A2E394D77B09.md)**  

-   **[QSPI\_ADDRESS\_LENGTH Enum](GUID-57799001-28D5-4E38-846D-487BF33CDBCF.md)**  

-   **[QSPI\_LANE\_WIDTH Enum](GUID-0E90E143-C131-4D4F-8CED-67A8FFF8ABE0.md)**  

-   **[QSPI\_OPTION\_LENGTH Enum](GUID-9C70503F-6CE6-442B-A7CF-88ABC449170E.md)**  

-   **[QSPI\_CLOCK\_PHASE Enum](GUID-A14FF81A-24A3-43A2-BCA3-F69CFE435ADA.md)**  

-   **[QSPI\_CLOCK\_POLARITY Enum](GUID-9BC01EA7-EC93-4396-98A1-F16E9CB52212.md)**  

-   **[QSPI\_DATA\_BITS Enum](GUID-4C44BB47-BF30-48AD-BD8A-A2757533075C.md)**  

-   **[QSPI\_TRANSFER\_SETUP Struct](GUID-C412DAB9-2077-4817-A1B9-C38109894040.md)**  

-   **[qspi\_command\_xfer\_t Struct](GUID-54C8D690-81CE-4D44-8B15-01E89BC66481.md)**  

-   **[qspi\_register\_xfer\_t Struct](GUID-4A2658DD-4E81-4E40-99B3-42AC38B6D021.md)**  

-   **[qspi\_memory\_xfer\_t Struct](GUID-1D968897-817D-4E39-BFEF-27D5448D4379.md)**  

-   **[QSPI\_CALLBACK Typedef](GUID-6F3AA8E6-B7CD-4D1D-B5D1-434051C00D87.md)**  


**Parent topic:**[SAM 9X60 Peripheral Libraries](GUID-CCAAC7F0-6BA8-4630-91AE-69718D188CBF.md)

**Parent topic:**[SAM A5D2 Peripheral Libraries](GUID-F6605EDC-FC71-4081-8560-0C1681C1FA8D.md)

**Parent topic:**[SAM E70 S70 V70 V71 Peripheral Libraries](GUID-6E45C146-6F6D-452A-A2E2-228C3CC905D7.md)

**Parent topic:**[SAM RH71 Peripheral Libraries](GUID-AC9BE324-E486-46EA-8D16-E04E15288053.md)

